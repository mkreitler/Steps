/*! Built with IMPACT - impactjs.com */

(function(window){"use strict";Number.prototype.map=function(istart,istop,ostart,ostop){return ostart+(ostop-ostart)*((this-istart)/(istop-istart));};Number.prototype.limit=function(min,max){return Math.min(max,Math.max(min,this));};Number.prototype.round=function(precision){precision=Math.pow(10,precision||0);return Math.round(this*precision)/precision;};Number.prototype.floor=function(){return Math.floor(this);};Number.prototype.ceil=function(){return Math.ceil(this);};Number.prototype.toInt=function(){return(this|0);};Number.prototype.toRad=function(){return(this/180)*Math.PI;};Number.prototype.toDeg=function(){return(this*180)/Math.PI;};Array.prototype.erase=function(item){for(var i=this.length;i--;){if(this[i]===item){this.splice(i,1);}}
return this;};Array.prototype.random=function(){return this[Math.floor(Math.random()*this.length)];};Function.prototype.bind=Function.prototype.bind||function(oThis){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");}
var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply((this instanceof fNOP&&oThis?this:oThis),aArgs.concat(Array.prototype.slice.call(arguments)));};fNOP.prototype=this.prototype;fBound.prototype=new fNOP();return fBound;};window.ig={game:null,debug:null,version:'1.21',global:window,modules:{},resources:[],ready:false,baked:false,nocache:'',ua:{},prefix:(window.ImpactPrefix||''),lib:'lib/',_current:null,_loadQueue:[],_waitForOnload:0,$:function(selector){return selector.charAt(0)=='#'?document.getElementById(selector.substr(1)):document.getElementsByTagName(selector);},$new:function(name){return document.createElement(name);},copy:function(object){if(!object||typeof(object)!='object'||object instanceof HTMLElement||object instanceof ig.Class){return object;}
else if(object instanceof Array){var c=[];for(var i=0,l=object.length;i<l;i++){c[i]=ig.copy(object[i]);}
return c;}
else{var c={};for(var i in object){c[i]=ig.copy(object[i]);}
return c;}},merge:function(original,extended){for(var key in extended){var ext=extended[key];if(typeof(ext)!='object'||ext instanceof HTMLElement||ext instanceof ig.Class){original[key]=ext;}
else{if(!original[key]||typeof(original[key])!='object'){original[key]=(ext instanceof Array)?[]:{};}
ig.merge(original[key],ext);}}
return original;},ksort:function(obj){if(!obj||typeof(obj)!='object'){return[];}
var keys=[],values=[];for(var i in obj){keys.push(i);}
keys.sort();for(var i=0;i<keys.length;i++){values.push(obj[keys[i]]);}
return values;},setVendorAttribute:function(el,attr,val){var uc=attr.charAt(0).toUpperCase()+attr.substr(1);el[attr]=el['ms'+uc]=el['moz'+uc]=el['webkit'+uc]=el['o'+uc]=val;},getVendorAttribute:function(el,attr){var uc=attr.charAt(0).toUpperCase()+attr.substr(1);return el[attr]||el['ms'+uc]||el['moz'+uc]||el['webkit'+uc]||el['o'+uc];},normalizeVendorAttribute:function(el,attr){var prefixedVal=ig.getVendorAttribute(el,attr);if(!el[attr]&&prefixedVal){el[attr]=prefixedVal;}},getImagePixels:function(image,x,y,width,height){var canvas=ig.$new('canvas');canvas.width=image.width;canvas.height=image.height;var ctx=canvas.getContext('2d');var ratio=ig.getVendorAttribute(ctx,'backingStorePixelRatio')||1;ig.normalizeVendorAttribute(ctx,'getImageDataHD');var realWidth=image.width/ratio,realHeight=image.height/ratio;canvas.width=Math.ceil(realWidth);canvas.height=Math.ceil(realHeight);ctx.drawImage(image,0,0,realWidth,realHeight);return(ratio===1)?ctx.getImageData(x,y,width,height):ctx.getImageDataHD(x,y,width,height);},module:function(name){if(ig._current){throw("Module '"+ig._current.name+"' defines nothing");}
if(ig.modules[name]&&ig.modules[name].body){throw("Module '"+name+"' is already defined");}
ig._current={name:name,requires:[],loaded:false,body:null};ig.modules[name]=ig._current;ig._loadQueue.push(ig._current);return ig;},requires:function(){ig._current.requires=Array.prototype.slice.call(arguments);return ig;},defines:function(body){ig._current.body=body;ig._current=null;ig._initDOMReady();},addResource:function(resource){ig.resources.push(resource);},setNocache:function(set){ig.nocache=set?'?'+Date.now():'';},log:function(){},assert:function(condition,msg){},show:function(name,number){},mark:function(msg,color){},_loadScript:function(name,requiredFrom){ig.modules[name]={name:name,requires:[],loaded:false,body:null};ig._waitForOnload++;var path=ig.prefix+ig.lib+name.replace(/\./g,'/')+'.js'+ig.nocache;var script=ig.$new('script');script.type='text/javascript';script.src=path;script.onload=function(){ig._waitForOnload--;ig._execModules();};script.onerror=function(){throw('Failed to load module '+name+' at '+path+' '+'required from '+requiredFrom);};ig.$('head')[0].appendChild(script);},_execModules:function(){var modulesLoaded=false;for(var i=0;i<ig._loadQueue.length;i++){var m=ig._loadQueue[i];var dependenciesLoaded=true;for(var j=0;j<m.requires.length;j++){var name=m.requires[j];if(!ig.modules[name]){dependenciesLoaded=false;ig._loadScript(name,m.name);}
else if(!ig.modules[name].loaded){dependenciesLoaded=false;}}
if(dependenciesLoaded&&m.body){ig._loadQueue.splice(i,1);m.loaded=true;m.body();modulesLoaded=true;i--;}}
if(modulesLoaded){ig._execModules();}
else if(!ig.baked&&ig._waitForOnload==0&&ig._loadQueue.length!=0){var unresolved=[];for(var i=0;i<ig._loadQueue.length;i++){var unloaded=[];var requires=ig._loadQueue[i].requires;for(var j=0;j<requires.length;j++){var m=ig.modules[requires[j]];if(!m||!m.loaded){unloaded.push(requires[j]);}}
unresolved.push(ig._loadQueue[i].name+' (requires: '+unloaded.join(', ')+')');}
throw('Unresolved (circular?) dependencies. '+"Most likely there's a name/path mismatch for one of the listed modules:\n"+
unresolved.join('\n'));}},_DOMReady:function(){if(!ig.modules['dom.ready'].loaded){if(!document.body){return setTimeout(ig._DOMReady,13);}
ig.modules['dom.ready'].loaded=true;ig._waitForOnload--;ig._execModules();}
return 0;},_boot:function(){if(document.location.href.match(/\?nocache/)){ig.setNocache(true);}
ig.ua.pixelRatio=window.devicePixelRatio||1;ig.ua.viewport={width:window.innerWidth,height:window.innerHeight};ig.ua.screen={width:window.screen.availWidth*ig.ua.pixelRatio,height:window.screen.availHeight*ig.ua.pixelRatio};ig.ua.iPhone=/iPhone/i.test(navigator.userAgent);ig.ua.iPhone4=(ig.ua.iPhone&&ig.ua.pixelRatio==2);ig.ua.iPad=/iPad/i.test(navigator.userAgent);ig.ua.android=/android/i.test(navigator.userAgent);ig.ua.iOS=ig.ua.iPhone||ig.ua.iPad;ig.ua.mobile=ig.ua.iOS||ig.ua.android;},_initDOMReady:function(){if(ig.modules['dom.ready']){ig._execModules();return;}
ig._boot();ig.modules['dom.ready']={requires:[],loaded:false,body:null};ig._waitForOnload++;if(document.readyState==='complete'){ig._DOMReady();}
else{document.addEventListener('DOMContentLoaded',ig._DOMReady,false);window.addEventListener('load',ig._DOMReady,false);}}};ig.normalizeVendorAttribute(window,'requestAnimationFrame');if(window.requestAnimationFrame){var next=1,anims={};window.ig.setAnimation=function(callback,element){var current=next++;anims[current]=true;var animate=function(){if(!anims[current]){return;}
window.requestAnimationFrame(animate,element);callback();};window.requestAnimationFrame(animate,element);return current;};window.ig.clearAnimation=function(id){delete anims[id];};}
else{window.ig.setAnimation=function(callback,element){return window.setInterval(callback,1000/60);};window.ig.clearAnimation=function(id){window.clearInterval(id);};}
var initializing=false,fnTest=/xyz/.test(function(){xyz;})?/\bparent\b/:/.*/;window.ig.Class=function(){};var inject=function(prop){var proto=this.prototype;var parent={};for(var name in prop){if(typeof(prop[name])=="function"&&typeof(proto[name])=="function"&&fnTest.test(prop[name])){parent[name]=proto[name];proto[name]=(function(name,fn){return function(){var tmp=this.parent;this.parent=parent[name];var ret=fn.apply(this,arguments);this.parent=tmp;return ret;};})(name,prop[name]);}
else{proto[name]=prop[name];}}};window.ig.Class.extend=function(prop){var parent=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){if(typeof(prop[name])=="function"&&typeof(parent[name])=="function"&&fnTest.test(prop[name])){prototype[name]=(function(name,fn){return function(){var tmp=this.parent;this.parent=parent[name];var ret=fn.apply(this,arguments);this.parent=tmp;return ret;};})(name,prop[name]);}
else{prototype[name]=prop[name];}}
function Class(){if(!initializing){if(this.staticInstantiate){var obj=this.staticInstantiate.apply(this,arguments);if(obj){return obj;}}
for(var p in this){if(typeof(this[p])=='object'){this[p]=ig.copy(this[p]);}}
if(this.init){this.init.apply(this,arguments);}}
return this;}
Class.prototype=prototype;Class.prototype.constructor=Class;Class.extend=window.ig.Class.extend;Class.inject=inject;return Class;};})(window);

// lib/impact/image.js
ig.baked=true;ig.module('impact.image').defines(function(){"use strict";ig.Image=ig.Class.extend({data:null,width:0,height:0,loaded:false,failed:false,loadCallback:null,path:'',staticInstantiate:function(path){return ig.Image.cache[path]||null;},init:function(path){this.path=path;this.load();},load:function(loadCallback){if(this.loaded){if(loadCallback){loadCallback(this.path,true);}
return;}
else if(!this.loaded&&ig.ready){this.loadCallback=loadCallback||null;this.data=new Image();this.data.onload=this.onload.bind(this);this.data.onerror=this.onerror.bind(this);this.data.src=ig.prefix+this.path+ig.nocache;}
else{ig.addResource(this);}
ig.Image.cache[this.path]=this;},reload:function(){this.loaded=false;this.data=new Image();this.data.onload=this.onload.bind(this);this.data.src=this.path+'?'+Date.now();},onload:function(event){this.width=this.data.width;this.height=this.data.height;this.loaded=true;if(ig.system.scale!=1){this.resize(ig.system.scale);}
if(this.loadCallback){this.loadCallback(this.path,true);}},onerror:function(event){this.failed=true;if(this.loadCallback){this.loadCallback(this.path,false);}},resize:function(scale){var origPixels=ig.getImagePixels(this.data,0,0,this.width,this.height);var widthScaled=this.width*scale;var heightScaled=this.height*scale;var scaled=ig.$new('canvas');scaled.width=widthScaled;scaled.height=heightScaled;var scaledCtx=scaled.getContext('2d');var scaledPixels=scaledCtx.getImageData(0,0,widthScaled,heightScaled);for(var y=0;y<heightScaled;y++){for(var x=0;x<widthScaled;x++){var index=(Math.floor(y/scale)*this.width+Math.floor(x/scale))*4;var indexScaled=(y*widthScaled+x)*4;scaledPixels.data[indexScaled]=origPixels.data[index];scaledPixels.data[indexScaled+1]=origPixels.data[index+1];scaledPixels.data[indexScaled+2]=origPixels.data[index+2];scaledPixels.data[indexScaled+3]=origPixels.data[index+3];}}
scaledCtx.putImageData(scaledPixels,0,0);this.data=scaled;},draw:function(targetX,targetY,sourceX,sourceY,width,height){if(!this.loaded){return;}
var scale=ig.system.scale;sourceX=sourceX?sourceX*scale:0;sourceY=sourceY?sourceY*scale:0;width=(width?width:this.width)*scale;height=(height?height:this.height)*scale;ig.system.context.drawImage(this.data,sourceX,sourceY,width,height,ig.system.getDrawPos(targetX),ig.system.getDrawPos(targetY),width,height);ig.Image.drawCount++;},drawTile:function(targetX,targetY,tile,tileWidth,tileHeight,flipX,flipY){tileHeight=tileHeight?tileHeight:tileWidth;if(!this.loaded||tileWidth>this.width||tileHeight>this.height){return;}
var scale=ig.system.scale;var tileWidthScaled=Math.floor(tileWidth*scale);var tileHeightScaled=Math.floor(tileHeight*scale);var scaleX=flipX?-1:1;var scaleY=flipY?-1:1;if(flipX||flipY){ig.system.context.save();ig.system.context.scale(scaleX,scaleY);}
ig.system.context.drawImage(this.data,(Math.floor(tile*tileWidth)%this.width)*scale,(Math.floor(tile*tileWidth/this.width)*tileHeight)*scale,tileWidthScaled,tileHeightScaled,ig.system.getDrawPos(targetX)*scaleX-(flipX?tileWidthScaled:0),ig.system.getDrawPos(targetY)*scaleY-(flipY?tileHeightScaled:0),tileWidthScaled,tileHeightScaled);if(flipX||flipY){ig.system.context.restore();}
ig.Image.drawCount++;}});ig.Image.drawCount=0;ig.Image.cache={};ig.Image.reloadCache=function(){for(var path in ig.Image.cache){ig.Image.cache[path].reload();}};});

// lib/impact/font.js
ig.baked=true;ig.module('impact.font').requires('impact.image').defines(function(){"use strict";ig.Font=ig.Image.extend({widthMap:[],indices:[],firstChar:32,alpha:1,letterSpacing:1,lineSpacing:0,onload:function(ev){this._loadMetrics(this.data);this.parent(ev);},widthForString:function(text){if(text.indexOf('\n')!==-1){var lines=text.split('\n');var width=0;for(var i=0;i<lines.length;i++){width=Math.max(width,this._widthForLine(lines[i]));}
return width;}
else{return this._widthForLine(text);}},_widthForLine:function(text){var width=0;for(var i=0;i<text.length;i++){width+=this.widthMap[text.charCodeAt(i)-this.firstChar]+this.letterSpacing;}
return width;},heightForString:function(text){return text.split('\n').length*(this.height+this.lineSpacing);},draw:function(text,x,y,align){if(typeof(text)!='string'){text=text.toString();}
if(text.indexOf('\n')!==-1){var lines=text.split('\n');var lineHeight=this.height+this.lineSpacing;for(var i=0;i<lines.length;i++){this.draw(lines[i],x,y+i*lineHeight,align);}
return;}
if(align==ig.Font.ALIGN.RIGHT||align==ig.Font.ALIGN.CENTER){var width=this._widthForLine(text);x-=align==ig.Font.ALIGN.CENTER?width/2:width;}
if(this.alpha!==1){ig.system.context.globalAlpha=this.alpha;}
for(var i=0;i<text.length;i++){var c=text.charCodeAt(i);x+=this._drawChar(c-this.firstChar,x,y);}
if(this.alpha!==1){ig.system.context.globalAlpha=1;}
ig.Image.drawCount+=text.length;},_drawChar:function(c,targetX,targetY){if(!this.loaded||c<0||c>=this.indices.length){return 0;}
var scale=ig.system.scale;var charX=this.indices[c]*scale;var charY=0;var charWidth=this.widthMap[c]*scale;var charHeight=(this.height-2)*scale;ig.system.context.drawImage(this.data,charX,charY,charWidth,charHeight,ig.system.getDrawPos(targetX),ig.system.getDrawPos(targetY),charWidth,charHeight);return this.widthMap[c]+this.letterSpacing;},_loadMetrics:function(image){this.height=image.height-1;this.widthMap=[];this.indices=[];var px=ig.getImagePixels(image,0,image.height-1,image.width,1);var currentChar=0;var currentWidth=0;for(var x=0;x<image.width;x++){var index=x*4+3;if(px.data[index]>127){currentWidth++;}
else if(px.data[index]==0&&currentWidth){this.widthMap.push(currentWidth);this.indices.push(x-currentWidth);currentChar++;currentWidth=0;}}
this.widthMap.push(currentWidth);this.indices.push(x-currentWidth);}});ig.Font.ALIGN={LEFT:0,RIGHT:1,CENTER:2};});

// lib/impact/sound.js
ig.baked=true;ig.module('impact.sound').defines(function(){"use strict";ig.SoundManager=ig.Class.extend({clips:{},volume:1,format:null,init:function(){if(!ig.Sound.enabled||!window.Audio){ig.Sound.enabled=false;return;}
var probe=new Audio();for(var i=0;i<ig.Sound.use.length;i++){var format=ig.Sound.use[i];if(probe.canPlayType(format.mime)){this.format=format;break;}}
if(!this.format){ig.Sound.enabled=false;}},load:function(path,multiChannel,loadCallback){var realPath=ig.prefix+path.replace(/[^\.]+$/,this.format.ext)+ig.nocache;if(this.clips[path]){if(multiChannel&&this.clips[path].length<ig.Sound.channels){for(var i=this.clips[path].length;i<ig.Sound.channels;i++){var a=new Audio(realPath);a.load();this.clips[path].push(a);}}
return this.clips[path][0];}
var clip=new Audio(realPath);if(loadCallback){clip.addEventListener('canplaythrough',function cb(ev){clip.removeEventListener('canplaythrough',cb,false);loadCallback(path,true,ev);},false);clip.addEventListener('error',function(ev){loadCallback(path,false,ev);},false);}
clip.preload='auto';clip.load();this.clips[path]=[clip];if(multiChannel){for(var i=1;i<ig.Sound.channels;i++){var a=new Audio(realPath);a.load();this.clips[path].push(a);}}
return clip;},get:function(path){var channels=this.clips[path];for(var i=0,clip;clip=channels[i++];){if(clip.paused||clip.ended){if(clip.ended){clip.currentTime=0;}
return clip;}}
channels[0].pause();channels[0].currentTime=0;return channels[0];}});ig.Music=ig.Class.extend({tracks:[],namedTracks:{},currentTrack:null,currentIndex:0,random:false,_volume:1,_loop:false,_fadeInterval:0,_fadeTimer:null,_endedCallbackBound:null,init:function(){this._endedCallbackBound=this._endedCallback.bind(this);if(Object.defineProperty){Object.defineProperty(this,"volume",{get:this.getVolume.bind(this),set:this.setVolume.bind(this)});Object.defineProperty(this,"loop",{get:this.getLooping.bind(this),set:this.setLooping.bind(this)});}
else if(this.__defineGetter__){this.__defineGetter__('volume',this.getVolume.bind(this));this.__defineSetter__('volume',this.setVolume.bind(this));this.__defineGetter__('loop',this.getLooping.bind(this));this.__defineSetter__('loop',this.setLooping.bind(this));}},add:function(music,name){if(!ig.Sound.enabled){return;}
var path=music instanceof ig.Sound?music.path:music;var track=ig.soundManager.load(path,false);track.loop=this._loop;track.volume=this._volume;track.addEventListener('ended',this._endedCallbackBound,false);this.tracks.push(track);if(name){this.namedTracks[name]=track;}
if(!this.currentTrack){this.currentTrack=track;}},next:function(){if(!this.tracks.length){return;}
this.stop();this.currentIndex=this.random?Math.floor(Math.random()*this.tracks.length):(this.currentIndex+1)%this.tracks.length;this.currentTrack=this.tracks[this.currentIndex];this.play();},pause:function(){if(!this.currentTrack){return;}
this.currentTrack.pause();},stop:function(){if(!this.currentTrack){return;}
this.currentTrack.pause();this.currentTrack.currentTime=0;},play:function(name){if(name&&this.namedTracks[name]){var newTrack=this.namedTracks[name];if(newTrack!=this.currentTrack){this.stop();this.currentTrack=newTrack;}}
else if(!this.currentTrack){return;}
this.currentTrack.play();},getLooping:function(){return this._loop;},setLooping:function(l){this._loop=l;for(var i in this.tracks){this.tracks[i].loop=l;}},getVolume:function(){return this._volume;},setVolume:function(v){this._volume=v.limit(0,1);for(var i in this.tracks){this.tracks[i].volume=this._volume;}},fadeOut:function(time){if(!this.currentTrack){return;}
clearInterval(this._fadeInterval);this.fadeTimer=new ig.Timer(time);this._fadeInterval=setInterval(this._fadeStep.bind(this),50);},_fadeStep:function(){var v=this.fadeTimer.delta().map(-this.fadeTimer.target,0,1,0).limit(0,1)*this._volume;if(v<=0.01){this.stop();this.currentTrack.volume=this._volume;clearInterval(this._fadeInterval);}
else{this.currentTrack.volume=v;}},_endedCallback:function(){if(this._loop){this.play();}
else{this.next();}}});ig.Sound=ig.Class.extend({path:'',volume:1,currentClip:null,multiChannel:true,init:function(path,multiChannel){this.path=path;this.multiChannel=(multiChannel!==false);this.load();},load:function(loadCallback){if(!ig.Sound.enabled){if(loadCallback){loadCallback(this.path,true);}
return;}
if(ig.ready){ig.soundManager.load(this.path,this.multiChannel,loadCallback);}
else{ig.addResource(this);}},play:function(){if(!ig.Sound.enabled){return;}
this.currentClip=ig.soundManager.get(this.path);this.currentClip.volume=ig.soundManager.volume*this.volume;this.currentClip.play();},stop:function(){if(this.currentClip){this.currentClip.pause();this.currentClip.currentTime=0;}}});ig.Sound.FORMAT={MP3:{ext:'mp3',mime:'audio/mpeg'},M4A:{ext:'m4a',mime:'audio/mp4; codecs=mp4a'},OGG:{ext:'ogg',mime:'audio/ogg; codecs=vorbis'},WEBM:{ext:'webm',mime:'audio/webm; codecs=vorbis'},CAF:{ext:'caf',mime:'audio/x-caf'}};ig.Sound.use=[ig.Sound.FORMAT.OGG,ig.Sound.FORMAT.MP3];ig.Sound.channels=4;ig.Sound.enabled=true;});

// lib/impact/loader.js
ig.baked=true;ig.module('impact.loader').requires('impact.image','impact.font','impact.sound').defines(function(){"use strict";ig.Loader=ig.Class.extend({resources:[],gameClass:null,status:0,done:false,_unloaded:[],_drawStatus:0,_intervalId:0,_loadCallbackBound:null,init:function(gameClass,resources){this.gameClass=gameClass;this.resources=resources;this._loadCallbackBound=this._loadCallback.bind(this);for(var i=0;i<this.resources.length;i++){this._unloaded.push(this.resources[i].path);}},load:function(){ig.system.clear('#000');if(!this.resources.length){this.end();return;}
for(var i=0;i<this.resources.length;i++){this.loadResource(this.resources[i]);}
this._intervalId=setInterval(this.draw.bind(this),16);},loadResource:function(res){res.load(this._loadCallbackBound);},end:function(){if(this.done){return;}
this.done=true;clearInterval(this._intervalId);ig.system.setGame(this.gameClass);},draw:function(){this._drawStatus+=(this.status-this._drawStatus)/5;var s=ig.system.scale;var w=ig.system.width*0.6;var h=ig.system.height*0.1;var x=ig.system.width*0.5-w/2;var y=ig.system.height*0.5-h/2;ig.system.context.fillStyle='#000';ig.system.context.fillRect(0,0,480,320);ig.system.context.fillStyle='#fff';ig.system.context.fillRect(x*s,y*s,w*s,h*s);ig.system.context.fillStyle='#000';ig.system.context.fillRect(x*s+s,y*s+s,w*s-s-s,h*s-s-s);ig.system.context.fillStyle='#fff';ig.system.context.fillRect(x*s,y*s,w*s*this._drawStatus,h*s);},_loadCallback:function(path,status){if(status){this._unloaded.erase(path);}
else{throw('Failed to load resource: '+path);}
this.status=1-(this._unloaded.length/this.resources.length);if(this._unloaded.length==0){setTimeout(this.end.bind(this),250);}}});});

// lib/impact/timer.js
ig.baked=true;ig.module('impact.timer').defines(function(){"use strict";ig.Timer=ig.Class.extend({target:0,base:0,last:0,pausedAt:0,init:function(seconds){this.base=ig.Timer.time;this.last=ig.Timer.time;this.target=seconds||0;},set:function(seconds){this.target=seconds||0;this.base=ig.Timer.time;this.pausedAt=0;},reset:function(){this.base=ig.Timer.time;this.pausedAt=0;},tick:function(){var delta=ig.Timer.time-this.last;this.last=ig.Timer.time;return(this.pausedAt?0:delta);},delta:function(){return(this.pausedAt||ig.Timer.time)-this.base-this.target;},pause:function(){if(!this.pausedAt){this.pausedAt=ig.Timer.time;}},unpause:function(){if(this.pausedAt){this.base+=ig.Timer.time-this.pausedAt;this.pausedAt=0;}}});ig.Timer._last=0;ig.Timer.time=Number.MIN_VALUE;ig.Timer.timeScale=1;ig.Timer.maxStep=0.05;ig.Timer.step=function(){var current=Date.now();var delta=(current-ig.Timer._last)/1000;ig.Timer.time+=Math.min(delta,ig.Timer.maxStep)*ig.Timer.timeScale;ig.Timer._last=current;};});

// lib/impact/system.js
ig.baked=true;ig.module('impact.system').requires('impact.timer','impact.image').defines(function(){"use strict";ig.System=ig.Class.extend({fps:30,width:320,height:240,realWidth:320,realHeight:240,scale:1,tick:0,animationId:0,newGameClass:null,running:false,delegate:null,clock:null,canvas:null,context:null,init:function(canvasId,fps,width,height,scale){this.fps=fps;this.clock=new ig.Timer();this.canvas=ig.$(canvasId);this.resize(width,height,scale);this.context=this.canvas.getContext('2d');this.getDrawPos=ig.System.drawMode;if(this.scale!=1){ig.System.scaleMode=ig.System.SCALE.CRISP;}
ig.System.scaleMode(this.canvas,this.context);},resize:function(width,height,scale){this.width=width;this.height=height;this.scale=scale||this.scale;this.realWidth=this.width*this.scale;this.realHeight=this.height*this.scale;this.canvas.width=this.realWidth;this.canvas.height=this.realHeight;},setGame:function(gameClass){if(this.running){this.newGameClass=gameClass;}
else{this.setGameNow(gameClass);}},setGameNow:function(gameClass){ig.game=new(gameClass)();ig.system.setDelegate(ig.game);},setDelegate:function(object){if(typeof(object.run)=='function'){this.delegate=object;this.startRunLoop();}else{throw('System.setDelegate: No run() function in object');}},stopRunLoop:function(){ig.clearAnimation(this.animationId);this.running=false;},startRunLoop:function(){this.stopRunLoop();this.animationId=ig.setAnimation(this.run.bind(this),this.canvas);this.running=true;},clear:function(color){this.context.fillStyle=color;this.context.fillRect(0,0,this.realWidth,this.realHeight);},run:function(){ig.Timer.step();this.tick=this.clock.tick();this.delegate.run();ig.input.clearPressed();if(this.newGameClass){this.setGameNow(this.newGameClass);this.newGameClass=null;}},getDrawPos:null});ig.System.DRAW={AUTHENTIC:function(p){return Math.round(p)*this.scale;},SMOOTH:function(p){return Math.round(p*this.scale);},SUBPIXEL:function(p){return p*this.scale;}};ig.System.drawMode=ig.System.DRAW.SMOOTH;ig.System.SCALE={CRISP:function(canvas,context){ig.setVendorAttribute(context,'imageSmoothingEnabled',false);canvas.style.imageRendering='-moz-crisp-edges';canvas.style.imageRendering='-o-crisp-edges';canvas.style.imageRendering='-webkit-optimize-contrast';canvas.style.imageRendering='crisp-edges';canvas.style.msInterpolationMode='nearest-neighbor';},SMOOTH:function(canvas,context){ig.setVendorAttribute(context,'imageSmoothingEnabled',true);canvas.style.imageRendering='';canvas.style.msInterpolationMode='';}};ig.System.scaleMode=ig.System.SCALE.SMOOTH;});

// lib/impact/input.js
ig.baked=true;ig.module('impact.input').defines(function(){"use strict";ig.KEY={'MOUSE1':-1,'MOUSE2':-3,'MWHEEL_UP':-4,'MWHEEL_DOWN':-5,'BACKSPACE':8,'TAB':9,'ENTER':13,'PAUSE':19,'CAPS':20,'ESC':27,'SPACE':32,'PAGE_UP':33,'PAGE_DOWN':34,'END':35,'HOME':36,'LEFT_ARROW':37,'UP_ARROW':38,'RIGHT_ARROW':39,'DOWN_ARROW':40,'INSERT':45,'DELETE':46,'_0':48,'_1':49,'_2':50,'_3':51,'_4':52,'_5':53,'_6':54,'_7':55,'_8':56,'_9':57,'A':65,'B':66,'C':67,'D':68,'E':69,'F':70,'G':71,'H':72,'I':73,'J':74,'K':75,'L':76,'M':77,'N':78,'O':79,'P':80,'Q':81,'R':82,'S':83,'T':84,'U':85,'V':86,'W':87,'X':88,'Y':89,'Z':90,'NUMPAD_0':96,'NUMPAD_1':97,'NUMPAD_2':98,'NUMPAD_3':99,'NUMPAD_4':100,'NUMPAD_5':101,'NUMPAD_6':102,'NUMPAD_7':103,'NUMPAD_8':104,'NUMPAD_9':105,'MULTIPLY':106,'ADD':107,'SUBSTRACT':109,'DECIMAL':110,'DIVIDE':111,'F1':112,'F2':113,'F3':114,'F4':115,'F5':116,'F6':117,'F7':118,'F8':119,'F9':120,'F10':121,'F11':122,'F12':123,'SHIFT':16,'CTRL':17,'ALT':18,'PLUS':187,'COMMA':188,'MINUS':189,'PERIOD':190};ig.Input=ig.Class.extend({bindings:{},actions:{},presses:{},locks:{},delayedKeyup:{},isUsingMouse:false,isUsingKeyboard:false,isUsingAccelerometer:false,mouse:{x:0,y:0},accel:{x:0,y:0,z:0},initMouse:function(){if(this.isUsingMouse){return;}
this.isUsingMouse=true;var mouseWheelBound=this.mousewheel.bind(this);ig.system.canvas.addEventListener('mousewheel',mouseWheelBound,false);ig.system.canvas.addEventListener('DOMMouseScroll',mouseWheelBound,false);ig.system.canvas.addEventListener('contextmenu',this.contextmenu.bind(this),false);ig.system.canvas.addEventListener('mousedown',this.keydown.bind(this),false);ig.system.canvas.addEventListener('mouseup',this.keyup.bind(this),false);ig.system.canvas.addEventListener('mousemove',this.mousemove.bind(this),false);ig.system.canvas.addEventListener('touchstart',this.keydown.bind(this),false);ig.system.canvas.addEventListener('touchend',this.keyup.bind(this),false);ig.system.canvas.addEventListener('touchmove',this.mousemove.bind(this),false);},initKeyboard:function(){if(this.isUsingKeyboard){return;}
this.isUsingKeyboard=true;window.addEventListener('keydown',this.keydown.bind(this),false);window.addEventListener('keyup',this.keyup.bind(this),false);},initAccelerometer:function(){if(this.isUsingAccelerometer){return;}
window.addEventListener('devicemotion',this.devicemotion.bind(this),false);},mousewheel:function(event){var delta=event.wheelDelta?event.wheelDelta:(event.detail*-1);var code=delta>0?ig.KEY.MWHEEL_UP:ig.KEY.MWHEEL_DOWN;var action=this.bindings[code];if(action){this.actions[action]=true;this.presses[action]=true;this.delayedKeyup[action]=true;event.stopPropagation();event.preventDefault();}},mousemove:function(event){var internalWidth=parseInt(ig.system.canvas.offsetWidth)||ig.system.realWidth;var scale=ig.system.scale*(internalWidth/ig.system.realWidth);var pos={left:0,top:0};if(ig.system.canvas.getBoundingClientRect){pos=ig.system.canvas.getBoundingClientRect();}
var ev=event.touches?event.touches[0]:event;this.mouse.x=(ev.clientX-pos.left)/scale;this.mouse.y=(ev.clientY-pos.top)/scale;},contextmenu:function(event){if(this.bindings[ig.KEY.MOUSE2]){event.stopPropagation();event.preventDefault();}},keydown:function(event){var tag=event.target.tagName;if(tag=='INPUT'||tag=='TEXTAREA'){return;}
var code=event.type=='keydown'?event.keyCode:(event.button==2?ig.KEY.MOUSE2:ig.KEY.MOUSE1);if(event.type=='touchstart'||event.type=='mousedown'){this.mousemove(event);}
var action=this.bindings[code];if(action){this.actions[action]=true;if(!this.locks[action]){this.presses[action]=true;this.locks[action]=true;}
event.stopPropagation();event.preventDefault();}},keyup:function(event){var tag=event.target.tagName;if(tag=='INPUT'||tag=='TEXTAREA'){return;}
var code=event.type=='keyup'?event.keyCode:(event.button==2?ig.KEY.MOUSE2:ig.KEY.MOUSE1);var action=this.bindings[code];if(action){this.delayedKeyup[action]=true;event.stopPropagation();event.preventDefault();}},devicemotion:function(event){this.accel=event.accelerationIncludingGravity;},bind:function(key,action){if(key<0){this.initMouse();}
else if(key>0){this.initKeyboard();}
this.bindings[key]=action;},bindTouch:function(selector,action){var element=ig.$(selector);var that=this;element.addEventListener('touchstart',function(ev){that.touchStart(ev,action);},false);element.addEventListener('touchend',function(ev){that.touchEnd(ev,action);},false);},unbind:function(key){var action=this.bindings[key];this.delayedKeyup[action]=true;this.bindings[key]=null;},unbindAll:function(){this.bindings={};this.actions={};this.presses={};this.locks={};this.delayedKeyup={};},state:function(action){return this.actions[action];},pressed:function(action){return this.presses[action];},released:function(action){return this.delayedKeyup[action];},clearPressed:function(){for(var action in this.delayedKeyup){this.actions[action]=false;this.locks[action]=false;}
this.delayedKeyup={};this.presses={};},touchStart:function(event,action){this.actions[action]=true;this.presses[action]=true;event.stopPropagation();event.preventDefault();return false;},touchEnd:function(event,action){this.delayedKeyup[action]=true;event.stopPropagation();event.preventDefault();return false;}});});

// lib/impact/impact.js
ig.baked=true;ig.module('impact.impact').requires('dom.ready','impact.loader','impact.system','impact.input','impact.sound').defines(function(){"use strict";ig.main=function(canvasId,gameClass,fps,width,height,scale,loaderClass){ig.system=new ig.System(canvasId,fps,width,height,scale||1);ig.input=new ig.Input();ig.soundManager=new ig.SoundManager();ig.music=new ig.Music();ig.ready=true;var loader=new(loaderClass||ig.Loader)(gameClass,ig.resources);loader.load();};});

// lib/impact/animation.js
ig.baked=true;ig.module('impact.animation').requires('impact.timer','impact.image').defines(function(){"use strict";ig.AnimationSheet=ig.Class.extend({width:8,height:8,image:null,init:function(path,width,height){this.width=width;this.height=height;this.image=new ig.Image(path);}});ig.Animation=ig.Class.extend({sheet:null,timer:null,sequence:[],flip:{x:false,y:false},pivot:{x:0,y:0},frame:0,tile:0,loopCount:0,alpha:1,angle:0,init:function(sheet,frameTime,sequence,stop){this.sheet=sheet;this.pivot={x:sheet.width/2,y:sheet.height/2};this.timer=new ig.Timer();this.frameTime=frameTime;this.sequence=sequence;this.stop=!!stop;this.tile=this.sequence[0];},rewind:function(){this.timer.set();this.loopCount=0;this.tile=this.sequence[0];return this;},gotoFrame:function(f){this.timer.set(this.frameTime*-f);this.update();},gotoRandomFrame:function(){this.gotoFrame(Math.floor(Math.random()*this.sequence.length))},update:function(){var frameTotal=Math.floor(this.timer.delta()/this.frameTime);this.loopCount=Math.floor(frameTotal/this.sequence.length);if(this.stop&&this.loopCount>0){this.frame=this.sequence.length-1;}
else{this.frame=frameTotal%this.sequence.length;}
this.tile=this.sequence[this.frame];},draw:function(targetX,targetY){var bbsize=Math.max(this.sheet.width,this.sheet.height);if(targetX>ig.system.width||targetY>ig.system.height||targetX+bbsize<0||targetY+bbsize<0){return;}
if(this.alpha!=1){ig.system.context.globalAlpha=this.alpha;}
if(this.angle==0){this.sheet.image.drawTile(targetX,targetY,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y);}
else{ig.system.context.save();ig.system.context.translate(ig.system.getDrawPos(targetX+this.pivot.x),ig.system.getDrawPos(targetY+this.pivot.y));ig.system.context.rotate(this.angle);this.sheet.image.drawTile(-this.pivot.x,-this.pivot.y,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y);ig.system.context.restore();}
if(this.alpha!=1){ig.system.context.globalAlpha=1;}}});});

// lib/impact/entity.js
ig.baked=true;ig.module('impact.entity').requires('impact.animation','impact.impact').defines(function(){"use strict";ig.Entity=ig.Class.extend({id:0,settings:{},size:{x:16,y:16},offset:{x:0,y:0},pos:{x:0,y:0},last:{x:0,y:0},vel:{x:0,y:0},accel:{x:0,y:0},friction:{x:0,y:0},maxVel:{x:100,y:100},zIndex:0,gravityFactor:1,standing:false,bounciness:0,minBounceVelocity:40,anims:{},animSheet:null,currentAnim:null,health:10,type:0,checkAgainst:0,collides:0,_killed:false,slopeStanding:{min:(44).toRad(),max:(136).toRad()},init:function(x,y,settings){this.id=++ig.Entity._lastId;this.pos.x=x;this.pos.y=y;ig.merge(this,settings);},addAnim:function(name,frameTime,sequence,stop){if(!this.animSheet){throw('No animSheet to add the animation '+name+' to.');}
var a=new ig.Animation(this.animSheet,frameTime,sequence,stop);this.anims[name]=a;if(!this.currentAnim){this.currentAnim=a;}
return a;},update:function(){this.last.x=this.pos.x;this.last.y=this.pos.y;this.vel.y+=ig.game.gravity*ig.system.tick*this.gravityFactor;this.vel.x=this.getNewVelocity(this.vel.x,this.accel.x,this.friction.x,this.maxVel.x);this.vel.y=this.getNewVelocity(this.vel.y,this.accel.y,this.friction.y,this.maxVel.y);var mx=this.vel.x*ig.system.tick;var my=this.vel.y*ig.system.tick;var res=ig.game.collisionMap.trace(this.pos.x,this.pos.y,mx,my,this.size.x,this.size.y);this.handleMovementTrace(res);if(this.currentAnim){this.currentAnim.update();}},getNewVelocity:function(vel,accel,friction,max){if(accel){return(vel+accel*ig.system.tick).limit(-max,max);}
else if(friction){var delta=friction*ig.system.tick;if(vel-delta>0){return vel-delta;}
else if(vel+delta<0){return vel+delta;}
else{return 0;}}
return vel.limit(-max,max);},handleMovementTrace:function(res){this.standing=false;if(res.collision.y){if(this.bounciness>0&&Math.abs(this.vel.y)>this.minBounceVelocity){this.vel.y*=-this.bounciness;}
else{if(this.vel.y>0){this.standing=true;}
this.vel.y=0;}}
if(res.collision.x){if(this.bounciness>0&&Math.abs(this.vel.x)>this.minBounceVelocity){this.vel.x*=-this.bounciness;}
else{this.vel.x=0;}}
if(res.collision.slope){var s=res.collision.slope;if(this.bounciness>0){var proj=this.vel.x*s.nx+this.vel.y*s.ny;this.vel.x=(this.vel.x-s.nx*proj*2)*this.bounciness;this.vel.y=(this.vel.y-s.ny*proj*2)*this.bounciness;}
else{var lengthSquared=s.x*s.x+s.y*s.y;var dot=(this.vel.x*s.x+this.vel.y*s.y)/lengthSquared;this.vel.x=s.x*dot;this.vel.y=s.y*dot;var angle=Math.atan2(s.x,s.y);if(angle>this.slopeStanding.min&&angle<this.slopeStanding.max){this.standing=true;}}}
this.pos=res.pos;},draw:function(){if(this.currentAnim){this.currentAnim.draw(this.pos.x-this.offset.x-ig.game._rscreen.x,this.pos.y-this.offset.y-ig.game._rscreen.y);}},kill:function(){ig.game.removeEntity(this);},receiveDamage:function(amount,from){this.health-=amount;if(this.health<=0){this.kill();}},touches:function(other){return!(this.pos.x>=other.pos.x+other.size.x||this.pos.x+this.size.x<=other.pos.x||this.pos.y>=other.pos.y+other.size.y||this.pos.y+this.size.y<=other.pos.y);},distanceTo:function(other){var xd=(this.pos.x+this.size.x/2)-(other.pos.x+other.size.x/2);var yd=(this.pos.y+this.size.y/2)-(other.pos.y+other.size.y/2);return Math.sqrt(xd*xd+yd*yd);},angleTo:function(other){return Math.atan2((other.pos.y+other.size.y/2)-(this.pos.y+this.size.y/2),(other.pos.x+other.size.x/2)-(this.pos.x+this.size.x/2));},check:function(other){},collideWith:function(other,axis){},ready:function(){}});ig.Entity._lastId=0;ig.Entity.COLLIDES={NEVER:0,LITE:1,PASSIVE:2,ACTIVE:4,FIXED:8};ig.Entity.TYPE={NONE:0,A:1,B:2,BOTH:3};ig.Entity.checkPair=function(a,b){if(a.checkAgainst&b.type){a.check(b);}
if(b.checkAgainst&a.type){b.check(a);}
if(a.collides&&b.collides&&a.collides+b.collides>ig.Entity.COLLIDES.ACTIVE){ig.Entity.solveCollision(a,b);}};ig.Entity.solveCollision=function(a,b){var weak=null;if(a.collides==ig.Entity.COLLIDES.LITE||b.collides==ig.Entity.COLLIDES.FIXED){weak=a;}
else if(b.collides==ig.Entity.COLLIDES.LITE||a.collides==ig.Entity.COLLIDES.FIXED){weak=b;}
if(a.last.x+a.size.x>b.last.x&&a.last.x<b.last.x+b.size.x){if(a.last.y<b.last.y){ig.Entity.seperateOnYAxis(a,b,weak);}
else{ig.Entity.seperateOnYAxis(b,a,weak);}
a.collideWith(b,'y');b.collideWith(a,'y');}
else if(a.last.y+a.size.y>b.last.y&&a.last.y<b.last.y+b.size.y){if(a.last.x<b.last.x){ig.Entity.seperateOnXAxis(a,b,weak);}
else{ig.Entity.seperateOnXAxis(b,a,weak);}
a.collideWith(b,'x');b.collideWith(a,'x');}};ig.Entity.seperateOnXAxis=function(left,right,weak){var nudge=(left.pos.x+left.size.x-right.pos.x);if(weak){var strong=left===weak?right:left;weak.vel.x=-weak.vel.x*weak.bounciness+strong.vel.x;var resWeak=ig.game.collisionMap.trace(weak.pos.x,weak.pos.y,weak==left?-nudge:nudge,0,weak.size.x,weak.size.y);weak.pos.x=resWeak.pos.x;}
else{var v2=(left.vel.x-right.vel.x)/2;left.vel.x=-v2;right.vel.x=v2;var resLeft=ig.game.collisionMap.trace(left.pos.x,left.pos.y,-nudge/2,0,left.size.x,left.size.y);left.pos.x=Math.floor(resLeft.pos.x);var resRight=ig.game.collisionMap.trace(right.pos.x,right.pos.y,nudge/2,0,right.size.x,right.size.y);right.pos.x=Math.ceil(resRight.pos.x);}};ig.Entity.seperateOnYAxis=function(top,bottom,weak){var nudge=(top.pos.y+top.size.y-bottom.pos.y);if(weak){var strong=top===weak?bottom:top;weak.vel.y=-weak.vel.y*weak.bounciness+strong.vel.y;var nudgeX=0;if(weak==top&&Math.abs(weak.vel.y-strong.vel.y)<weak.minBounceVelocity){weak.standing=true;nudgeX=strong.vel.x*ig.system.tick;}
var resWeak=ig.game.collisionMap.trace(weak.pos.x,weak.pos.y,nudgeX,weak==top?-nudge:nudge,weak.size.x,weak.size.y);weak.pos.y=resWeak.pos.y;weak.pos.x=resWeak.pos.x;}
else if(ig.game.gravity&&(bottom.standing||top.vel.y>0)){var resTop=ig.game.collisionMap.trace(top.pos.x,top.pos.y,0,-(top.pos.y+top.size.y-bottom.pos.y),top.size.x,top.size.y);top.pos.y=resTop.pos.y;if(top.bounciness>0&&top.vel.y>top.minBounceVelocity){top.vel.y*=-top.bounciness;}
else{top.standing=true;top.vel.y=0;}}
else{var v2=(top.vel.y-bottom.vel.y)/2;top.vel.y=-v2;bottom.vel.y=v2;var nudgeX=bottom.vel.x*ig.system.tick;var resTop=ig.game.collisionMap.trace(top.pos.x,top.pos.y,nudgeX,-nudge/2,top.size.x,top.size.y);top.pos.y=resTop.pos.y;var resBottom=ig.game.collisionMap.trace(bottom.pos.x,bottom.pos.y,0,nudge/2,bottom.size.x,bottom.size.y);bottom.pos.y=resBottom.pos.y;}};});

// lib/impact/map.js
ig.baked=true;ig.module('impact.map').defines(function(){"use strict";ig.Map=ig.Class.extend({tilesize:8,width:1,height:1,data:[[]],name:null,init:function(tilesize,data){this.tilesize=tilesize;this.data=data;this.height=data.length;this.width=data[0].length;},getTile:function(x,y){var tx=Math.floor(x/this.tilesize);var ty=Math.floor(y/this.tilesize);if((tx>=0&&tx<this.width)&&(ty>=0&&ty<this.height)){return this.data[ty][tx];}
else{return 0;}},setTile:function(x,y,tile){var tx=Math.floor(x/this.tilesize);var ty=Math.floor(y/this.tilesize);if((tx>=0&&tx<this.width)&&(ty>=0&&ty<this.height)){this.data[ty][tx]=tile;}}});});

// lib/impact/collision-map.js
ig.baked=true;ig.module('impact.collision-map').requires('impact.map').defines(function(){"use strict";ig.CollisionMap=ig.Map.extend({lastSlope:1,tiledef:null,init:function(tilesize,data,tiledef){this.parent(tilesize,data);this.tiledef=tiledef||ig.CollisionMap.defaultTileDef;for(var t in this.tiledef){if(t|0>this.lastSlope){this.lastSlope=t|0;}}},trace:function(x,y,vx,vy,objectWidth,objectHeight){var res={collision:{x:false,y:false,slope:false},pos:{x:x,y:y},tile:{x:0,y:0}};var steps=Math.ceil(Math.max(Math.abs(vx),Math.abs(vy))/this.tilesize);if(steps>1){var sx=vx/steps;var sy=vy/steps;for(var i=0;i<steps&&(sx||sy);i++){this._traceStep(res,x,y,sx,sy,objectWidth,objectHeight,vx,vy,i);x=res.pos.x;y=res.pos.y;if(res.collision.x){sx=0;vx=0;}
if(res.collision.y){sy=0;vy=0;}
if(res.collision.slope){break;}}}
else{this._traceStep(res,x,y,vx,vy,objectWidth,objectHeight,vx,vy,0);}
return res;},_traceStep:function(res,x,y,vx,vy,width,height,rvx,rvy,step){res.pos.x+=vx;res.pos.y+=vy;var t=0;if(vx){var pxOffsetX=(vx>0?width:0);var tileOffsetX=(vx<0?this.tilesize:0);var firstTileY=Math.max(Math.floor(y/this.tilesize),0);var lastTileY=Math.min(Math.ceil((y+height)/this.tilesize),this.height);var tileX=Math.floor((res.pos.x+pxOffsetX)/this.tilesize);var prevTileX=Math.floor((x+pxOffsetX)/this.tilesize);if(step>0||tileX==prevTileX||prevTileX<0||prevTileX>=this.width){prevTileX=-1;}
if(tileX>=0&&tileX<this.width){for(var tileY=firstTileY;tileY<lastTileY;tileY++){if(prevTileX!=-1){t=this.data[tileY][prevTileX];if(t>1&&t<=this.lastSlope&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,prevTileX,tileY)){break;}}
t=this.data[tileY][tileX];if(t==1||t>this.lastSlope||(t>1&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,tileX,tileY))){if(t>1&&t<=this.lastSlope&&res.collision.slope){break;}
res.collision.x=true;res.tile.x=t;x=res.pos.x=tileX*this.tilesize-pxOffsetX+tileOffsetX;rvx=0;break;}}}}
if(vy){var pxOffsetY=(vy>0?height:0);var tileOffsetY=(vy<0?this.tilesize:0);var firstTileX=Math.max(Math.floor(res.pos.x/this.tilesize),0);var lastTileX=Math.min(Math.ceil((res.pos.x+width)/this.tilesize),this.width);var tileY=Math.floor((res.pos.y+pxOffsetY)/this.tilesize);var prevTileY=Math.floor((y+pxOffsetY)/this.tilesize);if(step>0||tileY==prevTileY||prevTileY<0||prevTileY>=this.height){prevTileY=-1;}
if(tileY>=0&&tileY<this.height){for(var tileX=firstTileX;tileX<lastTileX;tileX++){if(prevTileY!=-1){t=this.data[prevTileY][tileX];if(t>1&&t<=this.lastSlope&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,tileX,prevTileY)){break;}}
t=this.data[tileY][tileX];if(t==1||t>this.lastSlope||(t>1&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,tileX,tileY))){if(t>1&&t<=this.lastSlope&&res.collision.slope){break;}
res.collision.y=true;res.tile.y=t;res.pos.y=tileY*this.tilesize-pxOffsetY+tileOffsetY;break;}}}}},_checkTileDef:function(res,t,x,y,vx,vy,width,height,tileX,tileY){var def=this.tiledef[t];if(!def){return false;}
var lx=(tileX+def[0])*this.tilesize,ly=(tileY+def[1])*this.tilesize,lvx=(def[2]-def[0])*this.tilesize,lvy=(def[3]-def[1])*this.tilesize,solid=def[4];var tx=x+vx+(lvy<0?width:0)-lx,ty=y+vy+(lvx>0?height:0)-ly;if(lvx*ty-lvy*tx>0){if(vx*-lvy+vy*lvx<0){return solid;}
var length=Math.sqrt(lvx*lvx+lvy*lvy);var nx=lvy/length,ny=-lvx/length;var proj=tx*nx+ty*ny;var px=nx*proj,py=ny*proj;if(px*px+py*py>=vx*vx+vy*vy){return solid||(lvx*(ty-vy)-lvy*(tx-vx)<0.5);}
res.pos.x=x+vx-px;res.pos.y=y+vy-py;res.collision.slope={x:lvx,y:lvy,nx:nx,ny:ny};return true;}
return false;}});var H=1/2,N=1/3,M=2/3,SOLID=true,NON_SOLID=false;ig.CollisionMap.defaultTileDef={5:[0,1,1,M,SOLID],6:[0,M,1,N,SOLID],7:[0,N,1,0,SOLID],3:[0,1,1,H,SOLID],4:[0,H,1,0,SOLID],2:[0,1,1,0,SOLID],10:[H,1,1,0,SOLID],21:[0,1,H,0,SOLID],32:[M,1,1,0,SOLID],43:[N,1,M,0,SOLID],54:[0,1,N,0,SOLID],27:[0,0,1,N,SOLID],28:[0,N,1,M,SOLID],29:[0,M,1,1,SOLID],25:[0,0,1,H,SOLID],26:[0,H,1,1,SOLID],24:[0,0,1,1,SOLID],11:[0,0,H,1,SOLID],22:[H,0,1,1,SOLID],33:[0,0,N,1,SOLID],44:[N,0,M,1,SOLID],55:[M,0,1,1,SOLID],16:[1,N,0,0,SOLID],17:[1,M,0,N,SOLID],18:[1,1,0,M,SOLID],14:[1,H,0,0,SOLID],15:[1,1,0,H,SOLID],13:[1,1,0,0,SOLID],8:[H,1,0,0,SOLID],19:[1,1,H,0,SOLID],30:[N,1,0,0,SOLID],41:[M,1,N,0,SOLID],52:[1,1,M,0,SOLID],38:[1,M,0,1,SOLID],39:[1,N,0,M,SOLID],40:[1,0,0,N,SOLID],36:[1,H,0,1,SOLID],37:[1,0,0,H,SOLID],35:[1,0,0,1,SOLID],9:[1,0,H,1,SOLID],20:[H,0,0,1,SOLID],31:[1,0,M,1,SOLID],42:[M,0,N,1,SOLID],53:[N,0,0,1,SOLID],12:[0,0,1,0,NON_SOLID],23:[1,1,0,1,NON_SOLID],34:[1,0,1,1,NON_SOLID],45:[0,1,0,0,NON_SOLID]};ig.CollisionMap.staticNoCollision={trace:function(x,y,vx,vy){return{collision:{x:false,y:false,slope:false},pos:{x:x+vx,y:y+vy},tile:{x:0,y:0}};}};});

// lib/impact/background-map.js
ig.baked=true;ig.module('impact.background-map').requires('impact.map','impact.image').defines(function(){"use strict";ig.BackgroundMap=ig.Map.extend({tiles:null,scroll:{x:0,y:0},distance:1,repeat:false,tilesetName:'',foreground:false,enabled:true,preRender:false,preRenderedChunks:null,chunkSize:512,debugChunks:false,anims:{},init:function(tilesize,data,tileset){this.parent(tilesize,data);this.setTileset(tileset);},setTileset:function(tileset){this.tilesetName=tileset instanceof ig.Image?tileset.path:tileset;this.tiles=new ig.Image(this.tilesetName);this.preRenderedChunks=null;},setScreenPos:function(x,y){this.scroll.x=x/this.distance;this.scroll.y=y/this.distance;},preRenderMapToChunks:function(){var totalWidth=this.width*this.tilesize*ig.system.scale,totalHeight=this.height*this.tilesize*ig.system.scale;var chunkCols=Math.ceil(totalWidth/this.chunkSize),chunkRows=Math.ceil(totalHeight/this.chunkSize);this.preRenderedChunks=[];for(var y=0;y<chunkRows;y++){this.preRenderedChunks[y]=[];for(var x=0;x<chunkCols;x++){var chunkWidth=(x==chunkCols-1)?totalWidth-x*this.chunkSize:this.chunkSize;var chunkHeight=(y==chunkRows-1)?totalHeight-y*this.chunkSize:this.chunkSize;this.preRenderedChunks[y][x]=this.preRenderChunk(x,y,chunkWidth,chunkHeight);}}},preRenderChunk:function(cx,cy,w,h){var tw=w/this.tilesize/ig.system.scale+1,th=h/this.tilesize/ig.system.scale+1;var nx=(cx*this.chunkSize/ig.system.scale)%this.tilesize,ny=(cy*this.chunkSize/ig.system.scale)%this.tilesize;var tx=Math.floor(cx*this.chunkSize/this.tilesize/ig.system.scale),ty=Math.floor(cy*this.chunkSize/this.tilesize/ig.system.scale);var chunk=ig.$new('canvas');chunk.width=w;chunk.height=h;var oldContext=ig.system.context;ig.system.context=chunk.getContext("2d");for(var x=0;x<tw;x++){for(var y=0;y<th;y++){if(x+tx<this.width&&y+ty<this.height){var tile=this.data[y+ty][x+tx];if(tile){this.tiles.drawTile(x*this.tilesize-nx,y*this.tilesize-ny,tile-1,this.tilesize);}}}}
ig.system.context=oldContext;return chunk;},draw:function(){if(!this.tiles.loaded||!this.enabled){return;}
if(this.preRender){this.drawPreRendered();}
else{this.drawTiled();}},drawPreRendered:function(){if(!this.preRenderedChunks){this.preRenderMapToChunks();}
var dx=ig.system.getDrawPos(this.scroll.x),dy=ig.system.getDrawPos(this.scroll.y);if(this.repeat){var w=this.width*this.tilesize*ig.system.scale;dx=(dx%w+w)%w;var h=this.height*this.tilesize*ig.system.scale;dy=(dy%h+h)%h;}
var minChunkX=Math.max(Math.floor(dx/this.chunkSize),0),minChunkY=Math.max(Math.floor(dy/this.chunkSize),0),maxChunkX=Math.ceil((dx+ig.system.realWidth)/this.chunkSize),maxChunkY=Math.ceil((dy+ig.system.realHeight)/this.chunkSize),maxRealChunkX=this.preRenderedChunks[0].length,maxRealChunkY=this.preRenderedChunks.length;if(!this.repeat){maxChunkX=Math.min(maxChunkX,maxRealChunkX);maxChunkY=Math.min(maxChunkY,maxRealChunkY);}
var nudgeY=0;for(var cy=minChunkY;cy<maxChunkY;cy++){var nudgeX=0;for(var cx=minChunkX;cx<maxChunkX;cx++){var chunk=this.preRenderedChunks[cy%maxRealChunkY][cx%maxRealChunkX];var x=-dx+cx*this.chunkSize-nudgeX;var y=-dy+cy*this.chunkSize-nudgeY;ig.system.context.drawImage(chunk,x,y);ig.Image.drawCount++;if(this.debugChunks){ig.system.context.strokeStyle='#f0f';ig.system.context.strokeRect(x,y,this.chunkSize,this.chunkSize);}
if(this.repeat&&chunk.width<this.chunkSize&&x+chunk.width<ig.system.realWidth){nudgeX=this.chunkSize-chunk.width;maxChunkX++;}}
if(this.repeat&&chunk.height<this.chunkSize&&y+chunk.height<ig.system.realHeight){nudgeY=this.chunkSize-chunk.height;maxChunkY++;}}},drawTiled:function(){var tile=0,anim=null,tileOffsetX=(this.scroll.x/this.tilesize).toInt(),tileOffsetY=(this.scroll.y/this.tilesize).toInt(),pxOffsetX=this.scroll.x%this.tilesize,pxOffsetY=this.scroll.y%this.tilesize,pxMinX=-pxOffsetX-this.tilesize,pxMinY=-pxOffsetY-this.tilesize,pxMaxX=ig.system.width+this.tilesize-pxOffsetX,pxMaxY=ig.system.height+this.tilesize-pxOffsetY;for(var mapY=-1,pxY=pxMinY;pxY<pxMaxY;mapY++,pxY+=this.tilesize){var tileY=mapY+tileOffsetY;if(tileY>=this.height||tileY<0){if(!this.repeat){continue;}
tileY=(tileY%this.height+this.height)%this.height;}
for(var mapX=-1,pxX=pxMinX;pxX<pxMaxX;mapX++,pxX+=this.tilesize){var tileX=mapX+tileOffsetX;if(tileX>=this.width||tileX<0){if(!this.repeat){continue;}
tileX=(tileX%this.width+this.width)%this.width;}
if((tile=this.data[tileY][tileX])){if((anim=this.anims[tile-1])){anim.draw(pxX,pxY);}
else{this.tiles.drawTile(pxX,pxY,tile-1,this.tilesize);}}}}}});});

// lib/impact/game.js
ig.baked=true;ig.module('impact.game').requires('impact.impact','impact.entity','impact.collision-map','impact.background-map').defines(function(){"use strict";ig.Game=ig.Class.extend({clearColor:'#000000',gravity:0,screen:{x:0,y:0},_rscreen:{x:0,y:0},entities:[],namedEntities:{},collisionMap:ig.CollisionMap.staticNoCollision,backgroundMaps:[],backgroundAnims:{},autoSort:false,sortBy:null,cellSize:64,_deferredKill:[],_levelToLoad:null,_doSortEntities:false,staticInstantiate:function(){this.sortBy=this.sortBy||ig.Game.SORT.Z_INDEX;ig.game=this;return null;},loadLevel:function(data){this.screen={x:0,y:0};this.entities=[];this.namedEntities={};for(var i=0;i<data.entities.length;i++){var ent=data.entities[i];this.spawnEntity(ent.type,ent.x,ent.y,ent.settings);}
this.sortEntities();this.collisionMap=ig.CollisionMap.staticNoCollision;this.backgroundMaps=[];for(var i=0;i<data.layer.length;i++){var ld=data.layer[i];if(ld.name=='collision'){this.collisionMap=new ig.CollisionMap(ld.tilesize,ld.data);}
else{var newMap=new ig.BackgroundMap(ld.tilesize,ld.data,ld.tilesetName);newMap.anims=this.backgroundAnims[ld.tilesetName]||{};newMap.repeat=ld.repeat;newMap.distance=ld.distance;newMap.foreground=!!ld.foreground;newMap.preRender=!!ld.preRender;newMap.name=ld.name;this.backgroundMaps.push(newMap);}}
for(var i=0;i<this.entities.length;i++){this.entities[i].ready();}},loadLevelDeferred:function(data){this._levelToLoad=data;},getMapByName:function(name){if(name=='collision'){return this.collisionMap;}
for(var i=0;i<this.backgroundMaps.length;i++){if(this.backgroundMaps[i].name==name){return this.backgroundMaps[i];}}
return null;},getEntityByName:function(name){return this.namedEntities[name];},getEntitiesByType:function(type){var entityClass=typeof(type)==='string'?ig.global[type]:type;var a=[];for(var i=0;i<this.entities.length;i++){var ent=this.entities[i];if(ent instanceof entityClass&&!ent._killed){a.push(ent);}}
return a;},spawnEntity:function(type,x,y,settings){var entityClass=typeof(type)==='string'?ig.global[type]:type;if(!entityClass){throw("Can't spawn entity of type "+type);}
var ent=new(entityClass)(x,y,settings||{});this.entities.push(ent);if(ent.name){this.namedEntities[ent.name]=ent;}
return ent;},sortEntities:function(){this.entities.sort(this.sortBy);},sortEntitiesDeferred:function(){this._doSortEntities=true;},removeEntity:function(ent){if(ent.name){delete this.namedEntities[ent.name];}
ent._killed=true;ent.type=ig.Entity.TYPE.NONE;ent.checkAgainst=ig.Entity.TYPE.NONE;ent.collides=ig.Entity.COLLIDES.NEVER;this._deferredKill.push(ent);},run:function(){this.update();this.draw();},update:function(){if(this._levelToLoad){this.loadLevel(this._levelToLoad);this._levelToLoad=null;}
if(this._doSortEntities||this.autoSort){this.sortEntities();this._doSortEntities=false;}
this.updateEntities();this.checkEntities();for(var i=0;i<this._deferredKill.length;i++){this.entities.erase(this._deferredKill[i]);}
this._deferredKill=[];for(var tileset in this.backgroundAnims){var anims=this.backgroundAnims[tileset];for(var a in anims){anims[a].update();}}},updateEntities:function(){for(var i=0;i<this.entities.length;i++){var ent=this.entities[i];if(!ent._killed){ent.update();}}},draw:function(){if(this.clearColor){ig.system.clear(this.clearColor);}
this._rscreen.x=ig.system.getDrawPos(this.screen.x)/ig.system.scale;this._rscreen.y=ig.system.getDrawPos(this.screen.y)/ig.system.scale;var mapIndex;for(mapIndex=0;mapIndex<this.backgroundMaps.length;mapIndex++){var map=this.backgroundMaps[mapIndex];if(map.foreground){break;}
map.setScreenPos(this.screen.x,this.screen.y);map.draw();}
this.drawEntities();for(mapIndex;mapIndex<this.backgroundMaps.length;mapIndex++){var map=this.backgroundMaps[mapIndex];map.setScreenPos(this.screen.x,this.screen.y);map.draw();}},drawEntities:function(){for(var i=0;i<this.entities.length;i++){this.entities[i].draw();}},checkEntities:function(){var hash={};for(var e=0;e<this.entities.length;e++){var entity=this.entities[e];if(entity.type==ig.Entity.TYPE.NONE&&entity.checkAgainst==ig.Entity.TYPE.NONE&&entity.collides==ig.Entity.COLLIDES.NEVER){continue;}
var checked={},xmin=Math.floor(entity.pos.x/this.cellSize),ymin=Math.floor(entity.pos.y/this.cellSize),xmax=Math.floor((entity.pos.x+entity.size.x)/this.cellSize)+1,ymax=Math.floor((entity.pos.y+entity.size.y)/this.cellSize)+1;for(var x=xmin;x<xmax;x++){for(var y=ymin;y<ymax;y++){if(!hash[x]){hash[x]={};hash[x][y]=[entity];}
else if(!hash[x][y]){hash[x][y]=[entity];}
else{var cell=hash[x][y];for(var c=0;c<cell.length;c++){if(entity.touches(cell[c])&&!checked[cell[c].id]){checked[cell[c].id]=true;ig.Entity.checkPair(entity,cell[c]);}}
cell.push(entity);}}}}}});ig.Game.SORT={Z_INDEX:function(a,b){return a.zIndex-b.zIndex;},POS_X:function(a,b){return(a.pos.x+a.size.x)-(b.pos.x+b.size.x);},POS_Y:function(a,b){return(a.pos.y+a.size.y)-(b.pos.y+b.size.y);}};});

// lib/game/math-utils.js
ig.baked=true;ig.module('game.math-utils').requires('impact.game','impact.font').defines(function(){MathUtils=ig.Class.extend({});MathUtils.EPSILON=0.001;MathUtils.ANGLE_EPSILON=0.0001;MathUtils.blend=function(start,dStart,end,dEnd,cur){return start*(1-cur)+end*cur;};MathUtils.cosBlend=function(time,period){return 1-0.5*(1+Math.cos(Math.PI*time/period));};});

// lib/game/constants.js
ig.baked=true;ig.module('game.constants').defines(function(){Constants=ig.Class.extend({});Constants.VICTORY_MSG_DURATION=2;Constants.ESCAPED_MSG_DURATION=2;Constants.TEXT_TUTORIAL_VICTORY="Well Done!";Constants.TEXT_TUTORIAL_OVER="Congratulations! You have completed the tutorial.";Constants.TEXT_LAST_LEVEL="This is the last level.";Constants.TEXT_STARTING_LEVEL="This is the first level.";Constants.TEXT_CONTROL_NOT_READY="This control isn't hooked up, yet.";Constants.TEXT_ESCAPED="Escaped!";Constants.TEXT_TRY_AGAIN="Better try again.";Constants.TEXT_LEVELS_DONT_EXIST="Coming Soon...";Constants.DEFAULT_TEXT_WIDTH="Level 777";Constants.STROKE_PURPLE="#7407b7";Constants.FILL_PURPLE="#9c71ff";Constants.DROPSHADOW_STROKE="#000000";Constants.DROPSHADOW_FILL="#000000";Constants.DEFAULT_REPLAY_DELAY=0.1;Constants.NEIGH_REPLAY_DELAY=2.0;Constants.DRAW_OFFSET_DX=2;Constants.DRAW_OFFSET_DY=2;Constants.DROPSHADOW_OFFSET_X=4;Constants.DROPSHADOW_OFFSET_Y=4;Constants.DROPSHADOW_ALPHA=0.25;Constants.AUTOCORRECT_TOLERANCE_X=2;Constants.AUTOCORRECT_TOLERANCE_Y=2;Constants.WIDTH=1024;Constants.HEIGHT=768;Constants.TILE_DX=64;Constants.TILE_DY=64;Constants.ROWS=9;Constants.COLS=13;Constants.DEMO_STATE={NONE:-99,INTRO:-1,CHOOSE_TUTORIAL_LEVEL:0,CHOOSE_DUKE_LEVEL:1,CHOOSE_AVA_LEVEL:2,CHOOSE_BOTH_LEVEL:3};Constants.TURN_LENGTH=1;Constants.CORRECTION_DX=Constants.TILE_DX;Constants.CORRECTION_DY=Constants.TILE_DY;Constants.OFFSET_Y=3*Constants.TILE_DY/2;Constants.OFFSET_X=Constants.TILE_DX/4;Constants.MOVE_SPOOK_RADIUS=3*Constants.TILE_DX/5;Constants.FORCE_SPOOK_RADIUS=Constants.TILE_DX;Constants.TILT_TIME=0.25;Constants.TILT_ANGLE=15*Math.PI/180;Constants.TILT_BUTTON_SPACER=0.167;Constants.INDEX_HORZ=0;Constants.INDEX_VERT=1;Constants.INDEX_TALLHORZ=2;Constants.INDEX_TALLVERT=3;Constants.INDEX_GATEHORZ=4;Constants.INDEX_GATEVERT=5;Constants.MESSAGE_FADE_TIME=0.33;Constants.DEFAULT_MSG_TIME=7.0;Constants.MSG_WINDOW_WIDTH=865;Constants.REAR_DURATION=1.0;Constants.JUMP_DURATION=0.5;Constants.PHASE_FACTOR=10;Constants.GOAL_ROW=0;Constants.GOAL_COL=9;Constants.GOAL_X=Constants.OFFSET_X+Constants.GOAL_COL*Constants.TILE_DY;Constants.GOAL_Y=Constants.OFFSET_Y+Constants.GOAL_ROW*Constants.TILE_DX;Constants.GENDER={MALE:0,FEMALE:1};Constants.COAT={SOLID:0,PINTO:1};Constants.TIER={DEMO:-1,TUTORIAL:0,DUKE:1,AVA:2,BOTH:3},Constants.HORSE_STATE={RESTING:0,RUNNING:1,WAITING:2,JUMPING:3},Constants.DIRECTION={UP:0,RIGHT:1,DOWN:2,LEFT:3,BLOCKED:-1,NONE:99};Constants.STAGE={IDLE:-1,SETUP:0,RESOLVE:1,FINISH:2};Constants.BLOCK_TYPE={NONE:0,HARD:1};Constants.COLLISION_FLAGS={HIGH:0x01,GATE:0x02};Constants.PATTERN_RIGHT_THEN_LEFT=[[Constants.DIRECTION.UP,Constants.DIRECTION.RIGHT,Constants.DIRECTION.LEFT],[Constants.DIRECTION.RIGHT,Constants.DIRECTION.DOWN,Constants.DIRECTION.UP],[Constants.DIRECTION.DOWN,Constants.DIRECTION.LEFT,Constants.DIRECTION.RIGHT],[Constants.DIRECTION.LEFT,Constants.DIRECTION.UP,Constants.DIRECTION.DOWN],];Constants.PATTERN_LEFT_THEN_RIGHT=[[Constants.DIRECTION.UP,Constants.DIRECTION.LEFT,Constants.DIRECTION.RIGHT],[Constants.DIRECTION.RIGHT,Constants.DIRECTION.UP,Constants.DIRECTION.DOWN],[Constants.DIRECTION.DOWN,Constants.DIRECTION.RIGHT,Constants.DIRECTION.LEFT],[Constants.DIRECTION.LEFT,Constants.DIRECTION.DOWN,Constants.DIRECTION.UP],];Constants.PASTURE_INDEX=2;Constants.GOAL_PASTURE_INDEX=0;});

// lib/game/sprite.js
ig.baked=true;ig.module('game.sprite').requires('impact.game','impact.font','game.constants').defines(function(){ig.CURRENT_SPRITE_ID=0;ig.resetSpriteIDs=function(){ig.CURRENT_SPRITE_ID=0;};Sprite=ig.Class.extend({frames:null,framePos:{x:0,y:0},visualGridPos:{row:-1,col:-1,x:-1,y:-1},trueGridPos:{row:-1,col:-1,x:-1,y:-1},wantDir:-1,id:0,bReverseX:false,collisionResults:null,drawOffset:0,localCollision:{x:0,y:0,bDidCollide:false,flags:0,oldRow:0,newRow:0,oldCol:0,newCol:0,oldChar:0,colCharNew:0,bVertical:false},phaseAngle:0,drawOrder:0,recomputeDrawOrder:function(){this.drawOrder=this.visualGridPos.y*Constants.WIDTH*this.id+this.visualGridPos.x;},getDrawOrder:function(){return this.drawOrder;},setDirection:function(direction){this.wantDir=direction;},getDrawAlpha:function(){return 1;},isBlocked:function(){return this.wantDir===Constants.DIRECTION.BLOCKED;},flipX:function(){this.bReverseX=!this.bReverseX;this.correctSign.x*=-1;},getWantDir:function(){return this.wantDir;},isMoving:function(){return this.wantDir!==Constants.DIRECTION.NONE&&this.wantDir!==Constants.DIRECTION.BLOCKED;},getID:function(){return this.id;},drawDebugLocations:function(){return false;},resolveMove:function(param){},isRearing:function(){return false;},init:function(x,y,settings){this.frames=settings.frames||null;this.phaseAngle=(Math.random()-0.5)*Math.PI/Constants.PHASE_FACTOR;this.visualGridPos.row=this.resolveRow(y);this.visualGridPos.col=this.resolveCol(x);this.trueGridPos.row=this.visualGridPos.row;this.trueGridPos.col=this.visualGridPos.col;this.trueGridPos.x=this.resolveX(this.trueGridPos.col);this.trueGridPos.y=this.resolveY(this.trueGridPos.row);this.visualGridPos.x=this.trueGridPos.x;this.visualGridPos.y=this.trueGridPos.y;ig.CURRENT_SPRITE_ID+=1;this.id=ig.CURRENT_SPRITE_ID;},getDebugColor:function(){return"#FF8800";},canJump:function(collisionResults){return false;},canOpenGate:function(collisionResults){return false;},resolveFreeMove:function(level){var dMove=ig.Game._dt/Constants.TURN_LENGTH;var bReduceLateralSlop=false;var bReduceVerticalSlop=false;var oldX=this.visualGridPos.x;var oldY=this.visualGridPos.y;var newX=oldX;var newY=oldY;var collisionLeadX=0;var collisionLeadY=0;var dynamicLeadX=0;var dynamicLeadY=0;switch(this.wantDir){case Constants.DIRECTION.BLOCKED:case Constants.DIRECTION.NONE:{bReduceLateralSlop=true;bReduceVerticalSlop=true;this.correctSign.x=0;this.correctSign.y=0;break;}
case Constants.DIRECTION.UP:{newY-=dMove*Constants.TILE_DY;this.correctSign.y=-1;bReduceLateralSlop=true;collisionLeadY=-Constants.TILE_DY/4;dynamicLead=-Constants.TILE_DY/2;break;}
case Constants.DIRECTION.RIGHT:{newX+=dMove*Constants.TILE_DX;this.correctSign.x=1;this.correctSign.y=0;bReduceVerticalSlop=true;collisionLeadX=Constants.TILE_DX/4;dynamicLeadX=Constants.TILE_DX/2;break;}
case Constants.DIRECTION.DOWN:{newY+=dMove*Constants.TILE_DY;this.correctSign.y=1;bReduceLateralSlop=true;collisionLeadY=Constants.TILE_DY/4;dynamicLeadY=Constants.TILE_DY/2;break;}
case Constants.DIRECTION.LEFT:{newX-=dMove*Constants.TILE_DX;this.correctSign.x=-1;this.correctSign.y=0;bReduceVerticalSlop=true;collisionLeadX=-Constants.TILE_DX/4;dynamicLeadX=-Constants.TILE_DX/2;break;}}
newX=Math.round(newX);newY=Math.round(newY);var newRow=this.resolveRow(newY+Constants.TILE_DY/2);var newCol=this.resolveCol(newX+Constants.TILE_DX/2);if(bReduceVerticalSlop){var idealY=this.resolveY(newRow);var dy=idealY-newY;if(dy*this.correctSign.y>=0&&(Math.abs(dy)>Constants.AUTOCORRECT_TOLERANCE_Y||!this.isMoving())){var dCorrection=Math.round(ig.Game._dt*Constants.CORRECTION_DY);if(dCorrection>Math.abs(dy)){dCorrection=Math.abs(dy);}
newY+=dCorrection*(dy>0?1:-1);}}
if(bReduceLateralSlop){var idealX=this.resolveX(newCol);var dx=idealX-newX;var dCorrection=Math.round(ig.Game._dt*Constants.AUTOCORRECT_CORRECTION_DX);if(dx*this.correctSign.x>=0&&(Math.abs(dx)>Constants.AUTOCORRECT_TOLERANCE_X||!this.isMoving())){var dCorrection=Math.round(ig.Game._dt*Constants.CORRECTION_DX);if(dCorrection>Math.abs(dx)){dCorrection=Math.abs(dx);}
newX+=dCorrection*(dx>0?1:-1);}}
this.checkStaticCollision(level,oldX,newX,Constants.TILE_DX/2,collisionLeadX,oldY,newY,Constants.TILE_DY/2,collisionLeadY);var bJumped=false;if(this.collisionResults.bDidCollide&&this.canJump(this.collisionResults)){bJumped=true;this.collisionResults.bDidCollide=false;}
else if(this.collisionResults.bDidCollide&&this.canOpenGate(this.collisionResults)&&level.openGate(this.collisionResults,this.getWantDir())){this.collisionResults.bDidCollide=false;}
else{newX=this.collisionResults.x;newY=this.collisionResults.y;}
if(this.collisionResults.bDidCollide){this.setDirection(Constants.DIRECTION.BLOCKED);}
else if(this.isMoving()){var bNearCollide=level.collideWithSceneElements(this,this.resolveRow(newY+Constants.TILE_DY/2),this.resolveCol(newX+Constants.TILE_DX/2),true,this.wantDir);var bFarCollide=level.collideWithSceneElements(this,this.resolveRow(newY+Constants.TILE_DY/2+dynamicLeadY),this.resolveCol(newX+Constants.TILE_DX/2+dynamicLeadX),false,this.wantDir);if(bNearCollide||bFarCollide){blockType=Constants.BLOCK_TYPE.HARD;this.collisionResults=this.localCollision;this.localCollision.x=oldX;this.localCollision.y=oldY;newX=oldX;newY=oldY;this.localCollision.bDidCollide=true;this.setDirection(Constants.DIRECTION.BLOCKED);}}
if(bJumped&&!this.collisionResults.bDidCollide){this.setDirection(this.wantDir);this.setState(Constants.HORSE_STATE.JUMPING);}
this.visualGridPos.x=newX;this.visualGridPos.y=newY;this.visualGridPos.row=this.resolveRow(newY+Constants.TILE_DY/2);this.visualGridPos.col=this.resolveCol(newX+Constants.TILE_DX/2);if(this.validateBounds(true)){this.visualGridPos.x=oldX;this.visualGridPos.y=oldY;this.visualGridPos.row=this.resolveRow(oldY+Constants.TILE_DY/2);this.visualGridPos.col=this.resolveCol(oldX+Constants.TILE_DX/2);this.setDirection(Constants.DIRECTION.BLOCKED);}
this.collisionResults.row=this.visualGridPos.row;this.collisionResults.col=this.visualGridPos.col;this.syncTruePositionToVisualPosition();},checkStaticCollision:function(level,oldX,newX,toCenterX,collisionLeadX,oldY,newY,toCenterY,collisionLeadY){this.collisionResults=level.checkStaticCollision(oldX,newX,toCenterX,collisionLeadX,oldY,newY,toCenterY,collisionLeadY);},checkBounds:function(level){var bOutOfBounds=this.validateBounds(true);this.validateBounds(false);if(bOutOfBounds){this.syncPixelsToRowsAndColumns(false);this.syncTruePositionToVisualPosition();level.removeFromScene(this,this.getRow(true),this.getCol(true));}
return bOutOfBounds;},syncPixelsToRowsAndColumns:function(bVisual){this.setRowCol(this.getRow(bVisual),this.getCol(bVisual));},validateBounds:function(bVisual){var bOutOfBounds=false;var minX=Constants.OFFSET_X;var maxX=Constants.OFFSET_X+Constants.COLS*Constants.TILE_DX;var minY=Constants.OFFSET_Y;var maxY=Constants.OFFSET_Y+Constants.ROWS*Constants.TILE_DY;var centerX=this.trueGridPos.x+Constants.TILE_DX/2;var centerY=this.trueGridPos.y+Constants.TILE_DY/2;if(bVisual){centerX=this.visualGridPos.x+Constants.TILE_DX/2;centerY=this.visualGridPos.y+Constants.TILE_DY/2;}
bOutOfBounds=centerX<minX||centerX>maxX||centerY<minY||centerY>maxY;return bOutOfBounds;},inSameSpotAs:function(otherSprite){return otherSprite&&(this.getRow(true)===otherSprite.getRow(true)&&this.getCol(true)===otherSprite.getCol(true));},setDrawOffset:function(offset){this.drawOffset=offset;},drawDebug:function(){if(true&&this.drawDebugLocations()){var ctx=ig.system.context;ctx.save();ctx.lineWidth=4;ctx.strokeStyle=this.getDebugColor();ctx.beginPath();ctx.arc(this.resolveX(this.getCol(false))+Constants.TILE_DX/2,this.resolveY(this.getRow(false))+Constants.TILE_DY/2,Constants.TILE_DX/2,0,Math.PI*2,false);ctx.closePath();ctx.stroke();ctx.restore();}},drawSimple:function(){if(this.frames){this.frames.draw(this.visualGridPos.x,this.visualGridPos.y);}},draw:function(){if(this.frames){var tileIndex=Math.round(this.frames.width/Constants.TILE_DX)*Math.round(this.framePos.y/Constants.TILE_DY)+
Math.round(this.framePos.x/Constants.TILE_DX);if(this.wantDir===Constants.DIRECTION.RIGHT){this.bReverseX=true;}
else if(this.wantDir===Constants.DIRECTION.LEFT){this.bReverseX=false;}
ig.system.context.globalAlpha=this.getDrawAlpha();this.frames.drawTile(-Constants.TILE_DX*0.5,-Constants.TILE_DY*0.5,tileIndex,Constants.TILE_DY,Constants.TILE_DY,this.bReverseX);ig.system.context.globalAlpha=1;if(false&&this.isMoving()){var ctx=ig.system.context;ctx.save();ctx.lineWidth=4;ctx.strokeStyle="#FFFFFF";ctx.globalAlpha=0.5;ctx.beginPath();ctx.moveTo(0,0);switch(this.wantDir){case Constants.DIRECTION.UP:{ctx.lineTo(0,-Constants.TILE_DY*0.75);break;}
case Constants.DIRECTION.RIGHT:{ctx.lineTo(Constants.TILE_DX*0.75,0);break;}
case Constants.DIRECTION.DOWN:{ctx.lineTo(0,Constants.TILE_DY*0.75);break;}
case Constants.DIRECTION.LEFT:{ctx.lineTo(-Constants.TILE_DX*0.75,0);break;}
case Constants.DIRECTION.BLOCKED:{ctx.strokeStyle="#FF0000";ctx.arc(0,0,Constants.TILE_DX/4,0,2*Math.PI,false);}
default:break;}
ctx.closePath();ctx.stroke();ctx.globalAlpha=1;ctx.restore();}}},setRowCol:function(newRow,newCol,bVisual){if(bVisual){this.visualGridPos.row=newRow;this.visualGridPos.col=newCol;this.visualGridPos.x=this.resolveX(newCol);this.visualGridPos.y=this.resolveY(newRow);}
else{this.trueGridPos.row=newRow;this.trueGridPos.col=newCol;this.trueGridPos.x=this.resolveX(newCol);this.trueGridPos.y=this.resolveY(newCol);}},setXY:function(newX,newY,bVisual){if(bVisual){this.visualGridPos.x=newX;this.visualGridPos.y=newY;this.visualGridPos.row=this.resolveRow(y);this.visualGridPos.col=this.resolveCol(x);}
else{this.trueGridPos.x=newX;this.trueGridPos.y=newY;this.trueGridPos.row=this.resolveRow(y);this.trueGridPos.col=this.resolveCol(x);}},getRowDelta:function(dir){var rowDelta=0;if(dir===Constants.DIRECTION.UP){rowDelta=-1;}
else if(dir===Constants.DIRECTION.DOWN){rowDelta=1;}
return rowDelta;},getColDelta:function(dir){var colDelta=0;if(dir===Constants.DIRECTION.RIGHT){colDelta=1;}
else if(dir===Constants.DIRECTION.LEFT){colDelta=-1;}
return colDelta;},getX:function(bVisual){var x=this.trueGridPos.x;if(bVisual){x=this.visualGridPos.x;}
return x;},getY:function(bVisual){var y=this.trueGridPos.y;if(bVisual){y=this.visualGridPos.y;}
return y;},getRow:function(bVisual){var row=this.trueGridPos.row;if(bVisual){row=this.visualGridPos.row;}
return row;},getCol:function(bVisual){var col=this.trueGridPos.col;if(bVisual){col=this.visualGridPos.col;}
return col;},syncTruePositionToVisualPosition:function(){this.trueGridPos.x=this.visualGridPos.x;this.trueGridPos.y=this.visualGridPos.y;this.trueGridPos.row=this.visualGridPos.row;this.trueGridPos.col=this.visualGridPos.col;},resolveRow:function(fromY){var row=Math.floor((fromY-Constants.OFFSET_Y)/Constants.TILE_DY);row=Math.max(0,row);row=Math.min(row,Constants.ROWS-1);return row;},resolveCol:function(fromX){var col=Math.floor((fromX-Constants.OFFSET_X)/Constants.TILE_DX);col=Math.max(0,col);col=Math.min(col,Constants.COLS-1);return col;},resolveX:function(fromCol){var x=fromCol*Constants.TILE_DX+Constants.OFFSET_X;x=Math.max(0,x);x=Math.min(Constants.WIDTH-1,x);return x;},resolveY:function(fromRow){var y=fromRow*Constants.TILE_DY+Constants.OFFSET_Y;y=Math.max(0,y);y=Math.min(Constants.HEIGHT-1,y);return y;}});Sprite.computeAnimAngle=function(){Sprite._sinValue=Math.sin(20*ig.Game._animTimer);Sprite._animAngle=0+Math.PI/10*Sprite._sinValue;};Sprite._sinValue=0;Sprite._animAngle=0;});

// lib/game/animal-sprite.js
ig.baked=true;ig.module('game.animal-sprite').requires('impact.game','impact.font','game.sprite').defines(function(){AnimalSprite=Sprite.extend({bMoveGoalSelected:false,pattern:null,bSpooked:false,spookPos:{x:0,y:0},bUpdated:false,update:function(level){this.bUpdated=true;},prepForUpdate:function(){this.bUpdated=false;},hasUpdated:function(){bUpdated=true;},moveGoalSelected:function(){return this.bMoveGoalSelected;},setMoveGoalSelected:function(){this.bMoveGoalSelected=true;},getSpookOffsetX:function(dir){var offsetX=0;switch(dir){case Constants.DIRECTION.RIGHT:{offsetX=1;break;}
case Constants.DIRECTION.LEFT:{offsetX=-1;break;}}
return offsetX;},getSpookOffsetY:function(dir){var offsetY=0;switch(dir){case Constants.DIRECTION.UP:{offsetY=-1;break;}
case Constants.DIRECTION.DOWN:{offsetY=1;break;}}
return offsetY;},spookAnimalsInDirection:function(level,spookRadius,spookDir){if(this.isMoving()){var spookX=this.getX(false)+Constants.TILE_DX/2+this.getSpookOffsetX(spookDir)*spookRadius;var spookY=this.getY(false)+Constants.TILE_DY/2+this.getSpookOffsetY(spookDir)*spookRadius;var testRow=this.resolveRow(spookY);var testCol=this.resolveCol(spookX);var bIsDuke=this instanceof Duke;this.spookPos.x=this.resolveX(testCol);this.spookPos.y=this.resolveY(testRow);var spookedAnimals=level.getAnimalsFromScene(testRow,testCol);for(var iAnimal=0;iAnimal<spookedAnimals.length;++iAnimal){var spookedAnimal=spookedAnimals[iAnimal];if(spookedAnimal&&spookedAnimal!==this){if(level.addToSpookList(spookedAnimal)){var bSpookedIsMoving=spookedAnimal.isMoving();var spookedDir=spookedAnimal.getWantDir();if(!bSpookedIsMoving||(bIsDuke&&!level.areOpposedDirections(spookedAnimal.getWantDir(),spookDir)&&level.isClearInDirection(spookedAnimal,spookDir).bIsClear)){spookedAnimal.setDirection(spookDir);if(!spookedAnimal.hasUpdated()){level.updateAnimal(spookedAnimal);}}}
else{break;}}}}},spookAnimals:function(level,spookRadius){this.spookAnimalsInDirection(level,spookRadius,this.wantDir);},setSpooked:function(bSpooked){this.bSpooked=bSpooked;},isSpooked:function(){return this.bSpooked;},chooseMoveGoal:function(){},endOfTurn:function(){this.bMoveGoalSelected=false;},getBlockTypeForLevelElement:function(element){return element==="."?Constants.BLOCK_TYPE.NONE:Constants.BLOCK_TYPE.HARD;},reset:function(){this.wantDir=Constants.DIRECTION.NONE;this.bMoveGoalSelected=false;},init:function(x,y,settings){this.parent(x,y,settings);this.reset();}});});

// lib/game/horse-sprite.js
ig.baked=true;ig.module('game.horse-sprite').requires('impact.game','impact.font','game.animal-sprite').defines(function(){ig.HORSE_FRAMES=new ig.Image("media/art/horses.png");HorseSprite=AnimalSprite.extend({gender:Constants.GENDER.MALE,coat:Constants.COAT.SOLID,state:Constants.HORSE_STATE.RESTING,rearTimer:0,isRearing:function(){return this.state===Constants.HORSE_STATE.WAITING;},isRunning:function(){return this.state===Constants.HORSE_STATE.RUNNING;},getTestDir:function(){return this.wantDir;},isBlocked:function(){return this.wantDir===Constants.DIRECTION.BLOCKED||this.state===Constants.HORSE_STATE.WAITING;},init:function(row,col,settings){x=this.resolveX(col);y=this.resolveY(row);settings.frames=ig.HORSE_FRAMES;this.pattern=Constants.PATTERN_RIGHT_THEN_LEFT;this.parent(x,y,settings);},isJumping:function(){return this.state===Constants.HORSE_STATE.JUMPING;},stateIs:function(testState){return this.state===testState;},setDirection:function(newDir){this.parent(newDir);var oldDir=this.wantDir;if(this.state!==Constants.HORSE_STATE.JUMPING){if(newDir===Constants.DIRECTION.BLOCKED){this.setState(Constants.HORSE_STATE.WAITING);}
else if(this.state===Constants.HORSE_STATE.RUNNING&&(newDir===Constants.DIRECTION.NONE||newDir===Constants.DIRECTION.BLOCKED)){this.setState(Constants.HORSE_STATE.WAITING);}
else if(newDir===Constants.DIRECTION.NONE){this.setState(Constants.HORSE_STATE.RESTING);}
else{this.setState(Constants.HORSE_STATE.RUNNING);}}
if(oldDir!==newDir&&this.isMoving()){ig.Game.sndBlow.play();}},setState:function(newState){var oldState=this.state;if(this.state!==newState){this.state=newState;if(newState===Constants.HORSE_STATE.WAITING){this.rearTimer=Constants.REAR_DURATION;}
else if(newState===Constants.HORSE_STATE.JUMPING){this.rearTimer=Constants.JUMP_DURATION;}
else{this.rearTimer=0;}
if(this instanceof Duke){if(oldState===Constants.HORSE_STATE.RESTING&&newState===Constants.HORSE_STATE.RUNNING){ig.Game.sndHuff.play();}
else if(oldState!==Constants.HORSE_STATE.WAITING&&newState===Constants.HORSE_STATE.WAITING){ig.Game.sndNeigh.play();}
else if(newState===Constants.HORSE_STATE.JUMPING){ig.Game.sndNeigh.play();}
else if(oldState!==Constants.HORSE_STATE.RESTING&&newState===Constants.HORSE_STATE.RESTING){ig.Game.sndBlow.play();}}}},update:function(level){this.parent();if(this.rearTimer>0){this.rearTimer=this.rearTimer-ig.Game._dt;if(this.rearTimer<=0){this.rearTimer=0;if(this.state===Constants.HORSE_STATE.JUMPING){this.setState(Constants.HORSE_STATE.RUNNING);if(!this.isMoving()){this.setDirection(Constants.DIRECTION.BLOCKED);}}
else{this.setState(Constants.HORSE_STATE.RESTING);}}}},getDebugColor:function(){var color;switch(this.state){case Constants.HORSE_STATE.WAITING:{color="#FF0000";break;}
case Constants.HORSE_STATE.RUNNING:{color="#FFFF00";break;}
case Constants.HORSE_STATE.RESTING:{color="#00FF00";break;}
default:color="#0000FF";break;}
return color;},getFramePos:function(){switch(this.state){case Constants.HORSE_STATE.WAITING:{this.framePos.y=0*Constants.TILE_DY;break;}
case Constants.HORSE_STATE.RUNNING:{this.framePos.y=1*Constants.TILE_DY;break;}
case Constants.HORSE_STATE.RESTING:{this.framePos.y=2*Constants.TILE_DY;break;}}
if(this.gender===Constants.GENDER.FEMALE){this.framePos.x=5*Constants.TILE_DX;}
else{this.framePos.x=0;}
if(this.coat===Constants.COAT.SOLID){this.framePos.x+=Constants.TILE_DX;}},drawDebug:function(){if(true&&this.drawDebugLocations()){this.parent();var ctx=ig.system.context;ctx.save();ctx.lineWidth=2;ctx.fillStyle="#00FFFF";ctx.globalAlpha=0.5;ctx.beginPath();ctx.arc(this.spookPos.x+Constants.TILE_DX/2,this.spookPos.y+Constants.TILE_DY/2,Constants.TILE_DX/4,0,Math.PI*2,true);ctx.closePath();ctx.fill();ctx.globalAlpha=1;ctx.restore();}},getRotation:function(){return Sprite._animAngle+this.phaseAngle;},draw:function(){this.getFramePos();ig.system.context.save();this.visualGridPos.x+=Constants.DRAW_OFFSET_DX*this.drawOffset;this.visualGridPos.y+=Constants.DRAW_OFFSET_DY*this.drawOffset;if(this.state===Constants.HORSE_STATE.JUMPING){ig.system.context.translate(this.visualGridPos.x+Constants.TILE_DX/2,this.visualGridPos.y+Constants.TILE_DY/2-Constants.TILE_DY/4*Math.sin(this.rearTimer/Constants.JUMP_DURATION*Math.PI));}
else{ig.system.context.translate(this.visualGridPos.x+Constants.TILE_DX/2,this.visualGridPos.y+Constants.TILE_DY/2);}
if(this.state===Constants.HORSE_STATE.RUNNING||this.state===Constants.HORSE_STATE.JUMPING){ig.system.context.rotate(this.getRotation());}
this.visualGridPos.x-=Constants.DRAW_OFFSET_DX*this.drawOffset;this.visualGridPos.y-=Constants.DRAW_OFFSET_DY*this.drawOffset;this.parent();ig.system.context.restore();}});});

// lib/game/free-stallion.js
ig.baked=true;ig.module('game.free-stallion').requires('impact.game','impact.font','game.horse-sprite').defines(function(){FreeStallion=HorseSprite.extend({gender:Constants.GENDER.MALE,coat:Constants.COAT.SOLID,state:Constants.HORSE_STATE.RESTING,correctSign:{x:0,y:0},collidePoint:{x:-100,y:-100},testDir:Constants.DIRECTION.NONE,drawDebugLocations:function(){return false;},draw:function(){this.parent();this.drawDebug();},getDrawAlpha:function(){var alpha=1;if(this.trueGridPos.row===Constants.GOAL_ROW){var dx=Math.abs(this.trueGridPos.x-this.resolveX(Constants.GOAL_COL));var dy=Math.abs(this.trueGridPos.y-this.resolveY(Constants.GOAL_ROW));alpha=Math.min((dx+dy)/(Constants.TILE_DX/2+Constants.TILE_DY/2),1);}
return alpha;},getTestDir:function(){return this.testDir;},drawDebug:function(){if(true&&this.drawDebugLocations()){this.parent();var ctx=ig.system.context;ctx.save();ctx.lineWidth=2;ctx.fillStyle="#FF00FF";ctx.globalAlpha=0.5;ctx.beginPath();ctx.arc(this.collidePoint.x+Constants.TILE_DX/2,this.collidePoint.y+Constants.TILE_DY/2,Constants.TILE_DX/4,0,Math.PI*2,true);ctx.closePath();ctx.fill();ctx.globalAlpha=1;ctx.restore();}},getPattern:function(level){return level.isMovingDir(this.wantDir)?Constants.PATTERN_RIGHT_THEN_LEFT[this.wantDir]:null},getSpookPattern:function(spookDir){return Constants.PATTERN_RIGHT_THEN_LEFT[spookDir];},resolveFreeMove:function(level){var pattern=this.getPattern(level);var dMove=ig.Game._dt/Constants.TURN_LENGTH;var oldX=this.visualGridPos.x;var oldY=this.visualGridPos.y;var newX;var newY;var blockType=Constants.BLOCK_TYPE.NONE;var nTests=pattern?pattern.length:1;this.testDir=this.wantDir;var bWantsFlip=false;level.removeFromScene(this,this.getRow(true),this.getCol(true));for(var i=0;i<nTests;++i){this.testDir=pattern?pattern[i]:this.wantDir;var bReduceLateralSlop=false;var bReduceVerticalSlop=false;var collisionLeadX=0;var collisionLeadY=0;var dynamicLeadX=0;var dynamicLeadY=0;var blockType=Constants.BLOCK_TYPE.NONE;newX=oldX;newY=oldY;if(this.isMoving()){this.spookAnimalsInDirection(level,Constants.MOVE_SPOOK_RADIUS,this.testDir);}
switch(this.testDir){case Constants.DIRECTION.BLOCKED:case Constants.DIRECTION.NONE:{bReduceLateralSlop=true;bReduceVerticalSlop=true;this.correctSign.x=0;this.correctSign.y=0;break;}
case Constants.DIRECTION.UP:{newY-=dMove*Constants.TILE_DY;this.correctSign.y=0;bReduceLateralSlop=true;collisionLeadY=-Constants.TILE_DY/2;dynamicLeadY=-Constants.TILE_DY/2;break;}
case Constants.DIRECTION.RIGHT:{newX+=dMove*Constants.TILE_DX;this.correctSign.x=0;bReduceVerticalSlop=true;collisionLeadX=Constants.TILE_DX/2;dynamicLeadX=Constants.TILE_DX/2;break;}
case Constants.DIRECTION.DOWN:{newY+=dMove*Constants.TILE_DY;this.correctSign.y=0;bReduceLateralSlop=true;collisionLeadY=Constants.TILE_DY/2;dynamicLeadY=Constants.TILE_DY/2;break;}
case Constants.DIRECTION.LEFT:{newX-=dMove*Constants.TILE_DX;this.correctSign.x=0;bReduceVerticalSlop=true;collisionLeadX=-Constants.TILE_DX/2;dynamicLeadX=-Constants.TILE_DX/2;break;}}
newX=Math.round(newX);newY=Math.round(newY);var newRow=this.resolveRow(newY+Constants.TILE_DY/2);var newCol=this.resolveCol(newX+Constants.TILE_DX/2);if(bReduceVerticalSlop){var idealY=this.resolveY(newRow);var dy=idealY-newY;if(dy*this.correctSign.y>=0){var dCorrection=Math.round(ig.Game._dt*Constants.CORRECTION_DY);if(dCorrection>Math.abs(dy)){dCorrection=Math.abs(dy);}
newY+=dCorrection*(dy>0?1:-1);}}
if(bReduceLateralSlop){var idealX=this.resolveX(newCol);var dx=idealX-newX;var dCorrection=Math.round(ig.Game._dt*Constants.CORRECTION_DX);if(dx*this.correctSign.x>=0){var dCorrection=Math.round(ig.Game._dt*Constants.CORRECTION_DY);if(dCorrection>Math.abs(dx)){dCorrection=Math.abs(dx);}
newX+=dCorrection*(dx>0?1:-1);}}
if(level.isMovingDir(this.testDir)&&this.trueGridPos.row>0){this.checkStaticCollision(level,oldX,newX,Constants.TILE_DX/2,collisionLeadX,oldY,newY,Constants.TILE_DY/2,collisionLeadY);newX=this.collisionResults.x;newY=this.collisionResults.y;if(this.collisionResults.bDidCollide){bWantsFlip=true;}}
else{this.collisionResults=this.localCollision;this.localCollision.x=newX;this.localCollision.y=newY;this.localCollision.bDidCollide=false;}
if(this.collisionResults.bDidCollide){blockType=Constants.BLOCK_TYPE.HARD;}
else if(this.isMoving()&&this.trueGridPos.row>0){this.collidePoint.x=this.resolveX(this.resolveCol(newX+Constants.TILE_DX/2+dynamicLeadX));this.collidePoint.y=this.resolveY(this.resolveRow(newY+Constants.TILE_DY/2+dynamicLeadY));var bNearCollide=level.collideWithSceneElements(this,this.resolveRow(newY+Constants.TILE_DY/2),this.resolveCol(newX+Constants.TILE_DX/2),true,this.testDir);var bFarCollide=level.collideWithSceneElements(this,this.resolveRow(newY+Constants.TILE_DY/2+dynamicLeadY),this.resolveCol(newX+Constants.TILE_DX/2+dynamicLeadX),false,this.testDir);if(bNearCollide||bFarCollide){blockType=Constants.BLOCK_TYPE.HARD;bWantsFlip=true;this.collisionResults=this.localCollision;this.localCollision.x=oldX;this.localCollision.y=oldY;newX=oldX;newY=oldY;this.localCollision.bDidCollide=true;}
else{blockType=Constants.BLOCK_TYPE.NONE;break;}}
else{blockType=Constants.BLOCK_TYPE.NONE;break;}}
if(blockType===Constants.BLOCK_TYPE.HARD){this.setDirection(Constants.DIRECTION.BLOCKED);this.setState(Constants.HORSE_STATE.WAITING);}
else{if(level.isMovingDir(this.testDir)){this.setDirection(this.testDir);}
if(bWantsFlip&&(this.testDir==Constants.DIRECTION.UP||Constants.DIRECTION.DOWN)){this.correctSign.x*=-1;this.flipX();}}
this.visualGridPos.x=newX;this.visualGridPos.y=newY;this.visualGridPos.row=this.resolveRow(newY+Constants.TILE_DY/2);this.visualGridPos.col=this.resolveCol(newX+Constants.TILE_DX/2);level.addToScene(this,this.getRow(true),this.getCol(true));this.collisionResults.row=this.visualGridPos.row;this.collisionResults.col=this.visualGridPos.col;this.syncTruePositionToVisualPosition();this.testDir=this.wantDir;},getDebugColor:function(){var color="#FFFFFF";if(this.collisionResults&&this.collisionResults.bDidCollide){color="#FF8800";}
else{switch(this.state){case Constants.HORSE_STATE.WAITING:{color="#FF0000";break;}
case Constants.HORSE_STATE.RUNNING:{color="#FFFF00";break;}
case Constants.HORSE_STATE.RESTING:{color="#00FF00";break;}
default:color="#0000FF";break;}}
return color;},checkStaticCollision:function(level,oldX,newX,toCenterX,collisionLeadX,oldY,newY,toCenterY,collisionLeadY){this.collisionResults=level.checkStaticCollision(oldX,newX,toCenterX,collisionLeadX,oldY,newY,toCenterY,collisionLeadY);},update:function(level){this.parent(level);if(this.trueGridPos.row===Constants.GOAL_ROW){if(this.trueGridPos.col<Constants.GOAL_COL){this.setDirection(Constants.DIRECTION.RIGHT);}
else if(this.trueGridPos.col>Constants.GOAL_COL){this.setDirection(Constants.DIRECTION.LEFT);}
else{this.setDirection(Constants.DIRECTION.UP);}}
this.resolveMove(level);},resolveMove:function(level){this.resolveFreeMove(level);}});});

// lib/game/free-pinto.js
ig.baked=true;ig.module('game.free-pinto').requires('impact.game','impact.font','game.free-stallion').defines(function(){FreePinto=FreeStallion.extend({coat:Constants.COAT.PINTO,getPattern:function(level){return level.isMovingDir(this.wantDir)?Constants.PATTERN_LEFT_THEN_RIGHT[this.wantDir]:null},getSpookPattern:function(spookDir){return Constants.PATTERN_LEFT_THEN_RIGHT[spookDir];}});});

// lib/game/free-mare.js
ig.baked=true;ig.module('game.free-mare').requires('impact.game','impact.font','game.free-stallion').defines(function(){FreeMare=FreeStallion.extend({gender:Constants.GENDER.FEMALE});});

// lib/game/free-pinto-mare.js
ig.baked=true;ig.module('game.free-pinto-mare').requires('impact.game','impact.font','game.free-pinto').defines(function(){FreePintoMare=FreePinto.extend({gender:Constants.GENDER.FEMALE});});

// lib/game/duke.js
ig.baked=true;ig.module('game.duke').requires('impact.game','impact.font','game.horse-sprite').defines(function(){Duke=HorseSprite.extend({gender:Constants.GENDER.MALE,coat:Constants.COAT.SOLID,state:Constants.HORSE_STATE.RESTING,correctSign:{x:0,y:0},bForceSpook:false,drawDebugLocations:function(){return false;},draw:function(){this.parent();this.drawDebug();},forceSpook:function(){this.bForceSpook=true;},setDirection:function(dir){var oldDir=this.wantDir;this.parent(dir);},update:function(level){var bSpooked=false;if(this.bForceSpook){this.spookAnimals(level,Constants.FORCE_SPOOK_RADIUS);bSpooked=true;this.bForceSpook=false;}
this.parent(level);this.resolveMove(level);if(!bSpooked&&this.isMoving()){this.spookAnimals(level,Constants.MOVE_SPOOK_RADIUS);}},canJump:function(collisionResults){return(this.trueGridPos.row<Constants.ROWS-1||this.wantDir!==Constants.DIRECTION.DOWN)&&!(collisionResults.flags&Constants.COLLISION_FLAGS.HIGH);},resolveMove:function(level){this.resolveFreeMove(level);},getRotation:function(){var rotation=Sprite._animAngle;if(this.state===Constants.HORSE_STATE.JUMPING){if(this.bReverseX){rotation=-Math.PI/6+Math.PI/3*(1-this.rearTimer/Constants.JUMP_DURATION);}
else{rotation=Math.PI/6-Math.PI/3*(1-this.rearTimer/Constants.JUMP_DURATION);}}
return rotation;},getFramePos:function(){switch(this.state){case Constants.HORSE_STATE.WAITING:case Constants.HORSE_STATE.JUMPING:{this.framePos.y=0*Constants.TILE_DY;break;}
case Constants.HORSE_STATE.RUNNING:{this.framePos.y=1*Constants.TILE_DY;break;}
case Constants.HORSE_STATE.RESTING:{this.framePos.y=2*Constants.TILE_DY;break;}}
this.framePos.x=4*Constants.TILE_DX;},getDebugColor:function(){var color;switch(this.state){case Constants.HORSE_STATE.WAITING:{color="#FF0000";break;}
case Constants.HORSE_STATE.RUNNING:{color="#FFFF00";break;}
case Constants.HORSE_STATE.RESTING:{color="#00FF00";break;}
case Constants.HORSE_STATE.JUMPING:{color="#0000FF";break;}
default:color="#0000FF";break;}
return color;},});});

// lib/game/ava-mare.js
ig.baked=true;ig.module('game.ava-mare').requires('impact.game','impact.font','game.duke').defines(function(){AvaMare=Duke.extend({gender:Constants.GENDER.FEMALE,canJump:function(collisionResults){return false;},canOpenGate:function(collisionResults){return(collisionResults.flags&Constants.COLLISION_FLAGS.GATE);},getFramePos:function(){switch(this.state){case Constants.HORSE_STATE.WAITING:case Constants.HORSE_STATE.JUMPING:{this.framePos.y=0*Constants.TILE_DY;break;}
case Constants.HORSE_STATE.RUNNING:{this.framePos.y=1*Constants.TILE_DY;break;}
case Constants.HORSE_STATE.RESTING:{this.framePos.y=2*Constants.TILE_DY;break;}}
this.framePos.x=3*Constants.TILE_DX;}});});

// lib/game/target.js
ig.baked=true;ig.module('game.target').requires('impact.game','impact.font','game.sprite').defines(function(){Target=Sprite.extend({bHidden:true,hide:function(){this.bHidden=true;},show:function(){this.bHidden=false;},resolveX:function(fromCol){var x=fromCol*Constants.TILE_DX+Constants.OFFSET_X+Constants.TILE_DX/2;x=Math.max(0,x);x=Math.min(Constants.WIDTH-1,x);return x;},resolveY:function(fromRow){var y=fromRow*Constants.TILE_DY+Constants.OFFSET_Y+Constants.TILE_DY/2;y=Math.max(0,y);y=Math.min(Constants.HEIGHT-1,y);return y;},onPress:function(x,y){var row=this.resolveRow(y);var col=this.resolveCol(x);this.setRowCol(row,col,true);this.setRowCol(row,col,false);this.show();},draw:function(){if(!this.bHidden){ig.system.context.save();ig.system.context.globalAlpha=0.5+0.5*Sprite._sinValue;this.frames.draw(this.visualGridPos.x-this.frames.width/2,this.visualGridPos.y-this.frames.height/2);ig.system.context.globalAlpha=1;ig.system.context.restore();}},init:function(x,y,imageFile){var settings={frames:new ig.Image(imageFile)};this.parent(x,y,settings);}});});

// lib/game/base-level.js
ig.baked=true;ig.module('game.base-level').requires('game.horse-sprite','game.free-stallion','game.free-pinto','game.free-mare','game.free-pinto-mare','game.ava-mare','game.duke','game.target','impact.game','impact.font').defines(function(){BaseLevel=ig.Class.extend({pastureImages:[new ig.Image("media/art/pasture_spring.png"),new ig.Image("media/art/pasture_summer.png"),new ig.Image("media/art/pasture_fall.png"),],fenceImages:[new ig.Image("media/art/fence_h.png"),new ig.Image("media/art/fence_v.png"),new ig.Image("media/art/fence-tall-h.png"),new ig.Image("media/art/fence-tall-v.png"),new ig.Image("media/art/efence-tall-h.png"),new ig.Image("media/art/efence-tall-v.png"),],xFenceInfo:{bGate:false},widgetList:[],spookList:[],isClearResults:{bIsClear:false,colliders:null},testLevel:[],field:[[],[],[],[],[],[],[],[],[],[],[],],messages:null,victoryMessage:null,vicMsgDuration:0,vicMsgCallback:null,bEscaped:false,scene:[[[],[],[],[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[],[],[],[]],],animals:[],duke:null,ava:null,activeActor:null,bStarted:false,horsesSaved:0,totalHorses:0,pressWidget:null,workPair:{x:0,y:0},collisionResult:{x:0,y:0,bDidCollide:false,flags:0,oldRow:0,newRow:0,oldCol:0,newCol:0,oldChar:0,colCharNew:0,bVertical:false},updateGallopLoop:function(){var bGalloping=this.duke?this.duke.isRunning():false;if(!bGalloping){bGalloping=this.ava?this.ava.isRunning():false;}
for(var i=0;!bGalloping&&i<this.animals.length;++i){bGalloping=this.animals[i].isRunning();}
if(bGalloping){this.startGallopLoop();}
else{this.stopGallopLoop();}},startGallopLoop:function(){if(!BaseLevel.bGallopStarted){BaseLevel.bGallopStarted=true;ig.music.play();}
else{ig.music.play();}},stopGallopLoop:function(){ig.music.pause();},activateDuke:function(){if(this.duke){this.activeActor=this.duke;}},activateAva:function(){if(this.ava){this.activeActor=this.ava;}},onPress:function(x,y){var bConsumed=false;for(var i=0;i<this.widgetList.length;++i){if(this.widgetList[i].onPress(x,y)){this.pressWidget=this.widgetList[i];bConsumed=true;break;}}
if(!bConsumed){if(this.duke){var dx=Math.abs(x-(this.duke.getX(true)+Constants.TILE_DX/2));var dy=Math.abs(y-(this.duke.getY(true)+Constants.TILE_DY/2));if(dx*dx+dy*dy<Constants.TILE_DX*Constants.TILE_DX/4){this.activateDuke();bConsumed=true;}}}
if(!bConsumed){if(this.ava){var dx=Math.abs(x-(this.ava.getX(true)+Constants.TILE_DX/2));var dy=Math.abs(y-(this.ava.getY(true)+Constants.TILE_DY/2));if(dx*dx+dy*dy<Constants.TILE_DX*Constants.TILE_DX/4){this.activateAva();bConsumed=true;}}}
return bConsumed;},onRelease:function(x,y){var bConsumed=false;if(this.pressWidget){this.pressWidget.released(x,y);this.pressWidget=null;bConsumed=true;}
else{for(var i=0;i<this.widgetList.length;++i){if(this.widgetList[i].onRelease(x,y)){bConsumed=true;break;}}}
return bConsumed;},restartLevel:function(){ig.Game._game.startLevel();},initLevel:function(geometry,hints,victoryMessage,victoryMsgDuration,victoryMsgCallback){this.messages=hints;this.victoryMessage=victoryMessage;this.vicMsgDuration=victoryMsgDuration;this.vicMsgCallback=victoryMsgCallback;this.horsesSaved=0;this.totalHorses=0;this.bStarted=false;this.activeActor=null;this.bEscaped=false;while(this.testLevel.length){this.testLevel.pop();}
for(var iRow=0;iRow<geometry.length;++iRow){this.testLevel.push(geometry[iRow].concat(""));}
for(var iRow=0;iRow<this.field.length;++iRow){while(this.field[iRow].length){this.field[iRow].pop();}}
for(var iRow=0;iRow<this.scene.length;++iRow){for(var iCol=0;iCol<this.scene[iRow].length;++iCol){while(this.scene[iRow][iCol].length){this.scene[iRow][iCol].pop();}}}
while(this.animals.length){this.animals.pop();}},collideWithSceneElements:function(mover,row,col,bNear,testDir){var bDidCollide=false;var collider=null;var bMoverIsDuke=mover&&(mover instanceof Duke);if(this.duke&&mover!==this.duke){if(row===this.duke.getRow(true)&&col===this.duke.getCol(true)){bDidCollide=true;collider=this.duke;}}
if(!bDidCollide&&this.ava&&mover!==this.ava){if(row===this.ava.getRow(true)&&col===this.ava.getCol(true)){bDidCollide=true;collider=this.ava;}}
if(bDidCollide){if(!bNear){bDidCollide=testDir!==collider.getWantDir();}}
return bDidCollide;if(!bDidCollide){var colliders=this.getAnimalsFromScene(row,col);for(var iAnimal=0;!bDidCollide&&iAnimal<colliders.length;++iAnimal){collider=colliders[iAnimal];if(collider.getRow()===Constants.GOAL_ROW){continue;}
else if(collider===mover){continue;}
var bLocalCollide=true;if(bLocalCollide&&!bMoverIsDuke){if(mover.inSameSpotAs(collider)){bLocalCollide=false;}
else if(bNear){bLocalCollide=testDir!==collider.getWantDir();}
else{bLocalCollide=collider.isBlocked()||this.areOpposedDirections(testDir,collider.getWantDir());}}
bDidCollide|=bLocalCollide;}}
return bDidCollide;},resetLevel:function(){},start:function(){for(var i=0;this.messages&&i<this.messages.length;++i){ig.Game.AddMessage(this.messages[i],null,-1);}
this.horsesSaved=0;},end:function(){},tallySafeHorse:function(horse){this.removeFromScene(horse,horse.getRow(),horse.getCol());this.animals.erase(horse);this.horsesSaved+=1;if(this.horsesSaved===this.totalHorses){ig.Game.FlushMessages();ig.Game.AddMessage(this.victoryMessage,null,this.vicMsgDuration,this.vicMsgCallback);}},removeFromScene:function(sprite,row,col){if(row>=0&&row<this.scene.length&&col>=0&&col<this.scene[row].length){this.scene[row][col].erase(sprite);}},addToScene:function(sprite,row,col){if(sprite&&row>=0&&row<this.scene.length&&col>=0&&col<this.scene[row].length){this.scene[row][col].unshift(sprite);}},updateInput:function(){var curDir=this.activeActor?this.activeActor.getWantDir():Constants.DIRECTION.NONE;while(this.activeActor&&ig.Game.CommandReady()){var cmd=ig.Game.UnqueueCommand();if(cmd===this.activeActor.getWantDir()){continue;}
else if(this.areOpposedDirections(curDir,cmd)){this.activeActor.setDirection(Constants.DIRECTION.NONE);break;}
else{this.activeActor.setDirection(cmd);this.activeActor.forceSpook();break;}}},powerOfTwoToDir:function(power){var direction=Constants.DIRECTION.NONE;while(power>8){power/=16;}
switch(power){case 1:{direction=Constants.DIRECTION.UP;break;}
case 2:{direction=Constants.DIRECTION.RIGHT;break;}
case 4:{direction=Constants.DIRECTION.DOWN;break;}
case 8:{direction=Constants.DIRECTION.LEFT;break;}}
return direction;},dirToPowerOfTwo:function(dir){var result=1;if(this.isMovingDir(dir)){for(var i=0;i<dir;++i){result*=2;}}
else{result=dir;}
return result;},isMovingDir:function(dir){return dir>=Constants.DIRECTION.UP&&dir<=Constants.DIRECTION.LEFT;},areOpposedDirections:function(dir1,dir2){var bOpposite=false;if(dir1<Constants.DIRECTION.NONE&&dir1>Constants.DIRECTION.BLOCKED&&dir2<Constants.DIRECTION.NONE&&dir2>Constants.DIRECTION.BLOCKED){var val1=this.dirToPowerOfTwo(dir1);var val2=this.dirToPowerOfTwo(dir2);bOpposite=val2>val1?val2/val1===4:val1/val2===4;}
return bOpposite;},isFence:function(testChar){return testChar!=='.';},isHighFence:function(testChar,bVertical){var bIsHighFence=false;this.xFenceInfo.bGate=this.isGateChar(testChar);if(bVertical){bIsHighFence=testChar===']'||this.xFenceInfo.bGate;}
else{bIsHighFence=testChar==='-'||this.xFenceInfo.bGate;}
return bIsHighFence;},isGateChar:function(testChar){return testChar==='r'||testChar==='l'||testChar==='t'||testChar==='b';},isVerticalGate:function(testChar){return testChar==='t'||testChar==='b';},openGate:function(collisionInfo,direction){var bGatesOpened=true;if(this.isGateChar(collisionInfo.oldChar)){bGatesOpened&=this.moveGate(collisionInfo.oldChar,collisionInfo,direction,true);}
if(this.isGateChar(collisionInfo.newChar)){bGatesOpened&=this.moveGate(collisionInfo.newChar,collisionInfo,direction,false);}
return bGatesOpened;},replaceChar:function(srcString,replaceIndex,newChar){var foreString=srcString.substr(0,replaceIndex);var aftString=srcString.substr(replaceIndex+1);return foreString+newChar+aftString;},isVerticalDirection:function(dir){return dir===Constants.DIRECTION.UP||dir===Constants.DIRECTION.DOWN;},gateIsClear:function(collisionInfo){},moveGate:function(gateChar,collisionInfo,direction,bOld){var bMoved=false;if(this.isVerticalGate(gateChar)&&!this.isVerticalDirection(direction)){var checkCol=bOld?collisionInfo.oldCol:collisionInfo.newCol;var checkRow=bOld?collisionInfo.oldRow:collisionInfo.newRow;var newCol=checkCol;var newRow=checkRow;var testCol=checkCol;var testRow=checkRow;var newChar=null;if(gateChar==='t'){if(direction===Constants.DIRECTION.LEFT){newRow-=1;newCol-=1;testRow=Math.floor(checkRow/2);testCol=Math.floor(newCol/2);newChar='r';}
else{newRow-=1;newCol+=1;testRow=Math.floor(checkRow/2);testCol=Math.floor(newCol/2);newChar='l';}}
else{if(direction===Constants.DIRECTION.LEFT){newRow+=1;newCol-=1;testRow=Math.floor(checkRow/2);testCol=Math.floor(newCol/2);newChar='r';}
else{newRow+=1;newCol+=1;testRow=Math.floor(checkRow/2);testCol=Math.floor(newCol/2);newChar='l';}}
if(this.testLevel[newRow][newCol]==='.'&&this.scene[testRow][testCol].length===0&&this.noActorsAt(testRow,testCol)){var geoString=this.testLevel[checkRow];this.testLevel[checkRow]=this.replaceChar(geoString,checkCol,'.');geoString=this.testLevel[newRow];this.testLevel[newRow]=this.replaceChar(geoString,newCol,newChar);bMoved=true;}}
else if(!this.isVerticalGate(gateChar)&&this.isVerticalDirection(direction)){var checkCol=bOld?collisionInfo.oldCol:collisionInfo.newCol;var checkRow=bOld?collisionInfo.oldRow:collisionInfo.newRow;var newCol=checkCol;var newRow=checkRow;var newChar=null;if(gateChar==='l'){if(direction===Constants.DIRECTION.UP){newRow-=1;newCol-=1;testRow=Math.floor(newRow/2);testCol=Math.floor(checkCol/2);newChar='b';}
else{newRow+=1;newCol-=1;testRow=Math.floor(newRow/2);testCol=Math.floor(checkCol/2);newChar='t';}}
else{if(direction===Constants.DIRECTION.UP){newRow-=1;newCol+=1;testRow=Math.floor(newRow/2);testCol=Math.floor(checkCol/2);newChar='b';}
else{newRow+=1;newCol+=1;testRow=Math.floor(newRow/2);testCol=Math.floor(checkCol/2);newChar='t';}}
if(this.testLevel[newRow][newCol]==='.'&&this.scene[testRow][testCol].length===0&&this.noActorsAt(testRow,testCol)){var geoString=this.testLevel[checkRow];this.testLevel[checkRow]=this.replaceChar(geoString,checkCol,'.');geoString=this.testLevel[newRow];this.testLevel[newRow]=this.replaceChar(geoString,newCol,newChar);bMoved=true;}}
if(bMoved){ig.Game.sndGate.play();}
return bMoved;},noActorsAt:function(row,col){var bDukeClear=this.duke?this.duke.getRow(true)!==row||this.duke.getCol(true)!==col:true;var bAvaClear=this.ava?this.ava.getRow(true)!==row||this.ava.getCol(true)!==col:true;return bDukeClear&&bAvaClear;},findCharInGeometry:function(testChar){var bFound=false;for(var iRow=0;iRow<this.testLevel.length;++iRow){var index=this.testLevel[iRow].indexOf(testChar);if(index>=0){this.workPair.y=iRow;this.workPair.x=index;bFound=true;break;}}
return bFound;},isClearInDirection:function(sprite,direction){var oldX=sprite.getX(true);var oldY=sprite.getY(true);var newX=oldX;var newY=oldY;switch(direction){case Constants.DIRECTION.UP:{newY-=Constants.TILE_DY;break;}
case Constants.DIRECTION.RIGHT:{newX+=Constants.TILE_DX;break;}
case Constants.DIRECTION.DOWN:{newY+=Constants.TILE_DY;break;}
case Constants.DIRECTION.LEFT:{newX-=Constants.TILE_DX;break;}}
bIsClear=!this.checkStaticCollision(oldX,newX,Constants.TILE_DX/2,0,oldY,newY,Constants.TILE_DY/2,0).bDidCollide;var newRow=sprite.resolveRow(newY);var newCol=sprite.resolveCol(newX);if(bIsClear&&this.duke){bIsClear=this.duke.getRow(true)!==newRow||this.duke.getCol(true)!==newCol;}
if(bIsClear&&this.ava){bIsClear=this.ava.getRow(true)!==newRow||this.ava.getCol(true)!==newCol;}
this.isClearResults.bIsClear=bIsClear;if(newRow>=0&&newRow<this.scene.length&&newCol>=0&&newCol<this.scene[newRow].length){this.isClearResults.colliders=this.scene[newRow][newCol];}
return this.isClearResults;},checkStaticCollision:function(oldX,newX,toCenterX,collisionLeadX,oldY,newY,toCenterY,collisionLeadY){var oldCenterX=oldX+toCenterX;var oldCenterY=oldY+toCenterY;var newCenterX=newX+toCenterX+collisionLeadX;var newCenterY=newY+toCenterY+collisionLeadY;var oldCol=Math.floor((oldCenterX-Constants.OFFSET_X)/Constants.TILE_DX);var newCol=Math.floor((newCenterX-Constants.OFFSET_X)/Constants.TILE_DX);var oldRow=Math.floor((oldCenterY-Constants.OFFSET_Y)/Constants.TILE_DY);var newRow=Math.floor((newCenterY-Constants.OFFSET_Y)/Constants.TILE_DY);this.collisionResult.x=newX;this.collisionResult.y=newY;this.collisionResult.bDidCollide=false;this.collisionResult.flags=0;if(oldCol!==newCol){var testLevelCol=2*Math.max(oldCol,newCol);var oldLevelRow=2*oldRow+1;var newLevelRow=2*newRow+1;var colCharOld=this.testLevel[oldLevelRow].charAt(testLevelCol);var colCharNew=this.testLevel[newLevelRow].charAt(testLevelCol);if(this.isFence(colCharOld)||this.isFence(colCharNew)){this.collisionResult.x=oldX;this.collisionResult.bDidCollide=true;if(this.isHighFence(colCharOld,true)||this.isHighFence(colCharNew,true)){if(this.xFenceInfo.bGate){this.collisionResult.flags|=Constants.COLLISION_FLAGS.GATE;this.collisionResult.oldRow=oldLevelRow;this.collisionResult.newRow=newLevelRow;this.collisionResult.oldCol=testLevelCol;this.collisionResult.newCol=testLevelCol;this.collisionResult.oldChar=colCharOld;this.collisionResult.newChar=colCharNew;this.collisionResult.bVertical=true;}
this.collisionResult.flags|=Constants.COLLISION_FLAGS.HIGH;}}}
if(oldRow!==newRow){var testLevelRow=2*Math.max(oldRow,newRow);var oldLevelCol=2*oldCol+1;var newLevelCol=2*newCol+1;var colCharOld=this.testLevel[testLevelRow].charAt(oldLevelCol);var colCharNew=this.testLevel[testLevelRow].charAt(newLevelCol);if(this.isFence(colCharOld)||this.isFence(colCharNew)){this.collisionResult.y=oldY;this.collisionResult.bDidCollide=true;if(this.isHighFence(colCharOld,false)||this.isHighFence(colCharNew,false)){if(this.xFenceInfo.bGate){this.collisionResult.flags|=Constants.COLLISION_FLAGS.GATE;this.collisionResult.oldRow=testLevelRow;this.collisionResult.newRow=testLevelRow;this.collisionResult.oldCol=oldLevelCol;this.collisionResult.newCol=newLevelCol;this.collisionResult.oldChar=colCharOld;this.collisionResult.newChar=colCharNew;this.collisionResult.bVertical=false;}
this.collisionResult.flags|=Constants.COLLISION_FLAGS.HIGH;}}}
return this.collisionResult;},addRandomFences:function(){for(var i=0;i<15;++i){if(Math.random()<0.5){row=Math.floor(Math.random()*(this.testLevel.length/2-3)+2)*2;col=Math.floor(Math.random()*(this.testLevel[0].length/2-3))*2+1;this.testLevel[row]=this.testLevel[row].substring(0,col)+'_'+this.testLevel[row].substr(col+1);}
else{row=Math.floor(Math.random()*(this.testLevel.length/2-3)+2)*2+1;col=Math.floor(Math.random()*(this.testLevel[0].length/2-3))*2;this.testLevel[row]=this.testLevel[row].substring(0,col)+'|'+this.testLevel[row].substr(col+1);}}},addWidget:function(newWidget){this.widgetList.push(newWidget);},removeWidget:function(oldWidget){this.widgetList.erase(oldWidget);},updateWidgets:function(){for(var i=0;i<this.widgetList.length;++i){this.widgetList[i].update();}},update:function(){if(this.duke){this.duke.update(this);this.duke.checkBounds(this);}
if(this.ava){this.ava.update(this);this.ava.checkBounds(this);}
for(var i=0;i<this.animals.length;++i){this.animals[i].prepForUpdate();}
for(var iRow=0;iRow<this.scene.length;++iRow){for(var iCol=0;iCol<this.scene[iRow].length;++iCol){while(this.spookList.length){this.spookList.pop();}
for(var iAnimal=0;iAnimal<this.scene[iRow][iCol].length;++iAnimal){var animal=this.scene[iRow][iCol][iAnimal];if(animal){this.updateAnimal(animal);}}}}
this.updateGallopLoop();this.updateWidgets();},addToSpookList:function(animal){var bCanContinue=true;if(this.spookList.indexOf(animal)>=0){bCanContinue=false;}
else{this.spookList.push(animal);}
return bCanContinue;},updateAnimal:function(animal){animal.update(this);if(animal.checkBounds(this)){if(animal.getRow()<=Constants.GOAL_ROW){this.tallySafeHorse(animal);}
else{if(!this.bEscaped){this.bEscaped=true;ig.Game.FlushMessages();ig.Game.AddMessage(Constants.TEXT_ESCAPED,null,Constants.ESCAPED_MSG_DURATION,null);ig.Game.AddMessage(Constants.TEXT_TRY_AGAIN,null,Constants.ESCAPED_MSG_DURATION,this.restartLevel.bind(this));}
this.animals.erase(animal);}}},getAnimalsFromScene:function(row,col){var animals=null;if(row>=0&&row<this.scene.length&&col>=0&&col<this.scene[row].length){animals=this.scene[row][col];}
return animals;},addAnimals:function(){for(var iRow=0;iRow<this.testLevel.length;++iRow){for(var iCol=0;iCol<this.testLevel[iRow].length;++iCol){if(iRow%2&&iCol%2&&this.testLevel[iRow][iCol]!=='*'){this.spawnActor(parseInt(this.testLevel[iRow][iCol]),Math.floor(iRow/2),Math.floor(iCol/2));}}}},spawnActor:function(type,row,col){switch(type){case 1:{this.duke=new Duke(row,col,{frames:null});this.activateDuke();break;}
case 2:{this.animals.push(new FreeStallion(row,col,{frames:null}));this.scene[row][col].push(this.animals[this.animals.length-1]);this.totalHorses+=1;break;}
case 3:{this.animals.push(new FreePinto(row,col,{frames:null}));this.scene[row][col].push(this.animals[this.animals.length-1]);this.totalHorses+=1;break;}
case 4:{this.ava=new AvaMare(row,col,{frames:null});if(this.activeActor===null){this.activateAva();}
break;}
case 5:{this.animals.push(new FreeMare(row,col,{frames:null}));this.scene[row][col].push(this.animals[this.animals.length-1]);this.totalHorses+=1;break;}
case 6:{this.animals.push(new FreePintoMare(row,col,{frames:null}));this.scene[row][col].push(this.animals[this.animals.length-1]);this.totalHorses+=1;break;}
default:{break;}}},createField:function(){var pastureSheet=this.pastureImages[Constants.PASTURE_INDEX];if(pastureSheet){var sheetRows=pastureSheet.height/Constants.TILE_DY;var sheetCols=pastureSheet.width/Constants.TILE_DX;for(var iRow=0;iRow<this.testLevel.length;++iRow){for(var iCol=0;iCol<this.testLevel[iRow].length;++iCol){if(iRow%2&&iCol%2){this.field[Math.floor(iRow/2)].push(Math.floor(Math.random()*sheetRows*sheetCols));}}}}
this.addAnimals();},drawBackground:function(){var sheetRows=this.pastureImages[0].height/Constants.TILE_DY;var sheetCols=this.pastureImages[0].width/Constants.TILE_DX;for(var iRow=0;iRow<this.field.length;++iRow){var pastureSheet=iRow>0?this.pastureImages[Constants.PASTURE_INDEX]:this.pastureImages[Constants.GOAL_PASTURE_INDEX];if(pastureSheet){var y=Constants.OFFSET_Y+iRow*Constants.TILE_DY;for(var iCol=0;iCol<this.field[iRow].length;++iCol){var x=Constants.OFFSET_X+iCol*Constants.TILE_DX;var spriteIndex=this.field[iRow][iCol];var spriteRow=Math.floor(spriteIndex/sheetCols);var spriteCol=spriteIndex-sheetCols*spriteRow;pastureSheet.draw(x,y,spriteCol*Constants.TILE_DX,spriteRow*Constants.TILE_DY,Constants.TILE_DX,Constants.TILE_DY);}}}},drawForeground:function(){var dukeRow=this.duke?this.duke.getRow(true):-1;var dukeCol=this.duke?this.duke.getCol(true):-1;var avaRow=this.ava?this.ava.getRow(true):-1;var avaCol=this.ava?this.ava.getCol(true):-1;for(var iRow=0;iRow<this.testLevel.length;++iRow){var y=(Math.floor(iRow/2)-0.5)*Constants.TILE_DY;if(iRow%2){y=Math.floor(iRow/2)*Constants.TILE_DY;}
y+=Constants.OFFSET_Y;for(var iCol=0;iCol<this.testLevel[iRow].length;++iCol){var x=(Math.floor(iCol/2)-0.5)*Constants.TILE_DX;if(iCol%2){x=Math.floor(iCol/2)*Constants.TILE_DX;}
var fenceChar=this.testLevel[iRow].charAt(iCol);x+=Constants.OFFSET_X;if(fenceChar==="|"){this.fenceImages[Constants.INDEX_VERT].draw(x,y);}
else if(fenceChar==="_"){this.fenceImages[Constants.INDEX_HORZ].draw(x,y);}
else if(fenceChar==="]"){this.fenceImages[Constants.INDEX_TALLVERT].draw(x,y);}
else if(fenceChar==="-"){this.fenceImages[Constants.INDEX_TALLHORZ].draw(x,y);}
else if(fenceChar==='t'||fenceChar==='b'){this.fenceImages[Constants.INDEX_GATEVERT].draw(x,y);}
else if(fenceChar==='r'||fenceChar==='l'){this.fenceImages[Constants.INDEX_GATEHORZ].draw(x,y);}
if(iRow%2&&iCol%2){var sceneRow=Math.floor(iRow/2);var sceneCol=Math.floor(iCol/2);var animals=this.scene[sceneRow][sceneCol];var endIndex=animals.length-1;var drawIndex=0;while(endIndex>=0){var minIndex=endIndex;var minValue=animals[minIndex].drawOrder;for(var iAnimal=0;iAnimal<endIndex-1;++iAnimal){var testValue=animals[iAnimal].drawOrder;if(testValue<minValue){minValue=testValue;minIndex=iAnimal;}}
var sceneElement=animals[minIndex];if(sceneElement){sceneElement.setDrawOffset(drawIndex);sceneElement.draw();}
animals[minIndex]=animals[endIndex];animals[endIndex]=sceneElement;endIndex-=1;drawIndex++;}
if(this.ava&&sceneRow===avaRow&&sceneCol===avaCol&&!this.ava.isJumping()){this.ava.draw();}
if(this.duke&&sceneRow===dukeRow&&sceneCol===dukeCol&&!this.duke.isJumping()){this.duke.draw();}}}}},drawAllWidgets:function(){for(var i=0;i<this.widgetList.length;++i){this.widgetList[i].draw();}},drawWidgets:function(){this.drawAllWidgets();},drawAboveGround:function(){if(this.duke&&this.duke.isJumping()){this.duke.draw();}},draw:function(){for(var i=0;i<this.animals.length;++i){this.animals[i].recomputeDrawOrder();}
this.drawBackground();this.drawForeground();this.drawAboveGround();this.drawWidgets();}});BaseLevel.bGallopStarted=false;});

// lib/game/ui-widget.js
ig.baked=true;ig.module('game.ui-widget').requires('impact.game','impact.font').defines(function(){Widget=ig.Class.extend({bounds:{x:0,y:0,width:0,height:0},bActive:false,onPressSound:null,activate:function(){this.bActive=true;},deactivate:function(){this.bActive=false;},getBoundsRef:function(){return this.bounds;},init:function(x,y,width,height,settings){this.bounds.x=x;this.bounds.y=y;this.bounds.width=width;this.bounds.height=height;this.onPressSound=settings.onPressSound||null;this.bActive=true;},containsPoint:function(x,y){return this.bActive&&x>=this.bounds.x&&x<=this.bounds.x+this.bounds.width&&y>=this.bounds.y&&y<=this.bounds.y+this.bounds.height;},onPress:function(x,y){var bConsumed=this.containsPoint(x,y);if(bConsumed){this.pressed(x,y);}
return bConsumed;},update:function(){},draw:function(){},onRelease:function(x,y){this.released(x,y);},pressed:function(x,y){if(this.onPressSound){this.onPressSound.play();}},released:function(x,y){},});});

// lib/game/ui-tilt-button.js
ig.baked=true;ig.module('game.ui-tilt-button').requires('impact.game','impact.font','game.ui-widget').defines(function(){TiltButton=Widget.extend({image:null,tiltAngle:0,tiltTime:0,animTimer:0,animDir:0,fnTrigger:0,triggerData:null,init:function(x,y,settings){this.image=settings.image||null;this.tiltAngle=settings.tiltAngle||0;this.tiltTime=settings.tiltTime||0.001;this.fnTrigger=settings.fnTrigger||null;this.triggerData=settings.triggerData||null;this.parent(x,y,this.image?this.image.width:0,this.image?this.image.height:0,settings);},pressed:function(x,y){this.parent(x,y);if(this.animDir===0){this.animDir=1;this.animTimer=this.tiltTime;}},update:function(){if(this.animDir!==0){var bTriggered=false;if(this.animTimer>0){this.animTimer-=ig.Game._dt;if(this.animTimer<=0){bTriggered=true;}}
if(bTriggered){if(this.animDir>0&&this.fnTrigger){this.fnTrigger(this.triggerData);}
if(this.animDir>0){this.animDir=-1;this.animTimer=this.tiltTime;}
else{this.animDir=0;this.animTimer=0;}}}},draw:function(){var animParam=0;if(this.image){if(this.animDir>0){animParam=1-MathUtils.cosBlend(this.animTimer,this.tiltTime);}
else if(this.animDir<0){animParam=MathUtils.cosBlend(this.animTimer,this.tiltTime);}
var rotAngle=this.tiltAngle*animParam;if(Math.abs(rotAngle)>MathUtils.ANGLE_EPSILON){var ctx=ig.system.context;ctx.save();ctx.translate(this.bounds.x+this.bounds.width/2,this.bounds.y+this.bounds.height/2);ctx.rotate(rotAngle);this.image.draw(-this.bounds.width/2,-this.bounds.height/2);ctx.restore();}
else{this.image.draw(this.bounds.x,this.bounds.y);}}}});});

// lib/game/ui-hotbox.js
ig.baked=true;ig.module('game.ui-hotbox').requires('impact.game','impact.font','game.ui-widget').defines(function(){HotBox=Widget.extend({pressCallback:null,pressData:null,init:function(x,y,width,height,settings){this.parent(x,y,width,height,settings);this.pressCallback=settings.pressCallback||null;this.pressData=settings.pressData||null;},pressed:function(x,y){this.parent(x,y);if(this.pressCallback){this.pressCallback(this.pressData);}},draw:function(){this.parent();if(false){var ctx=ig.system.context;ctx.save();ctx.lineWidth=2;ctx.strokeStyle="#00FFFF";ctx.beginPath();ctx.moveTo(this.bounds.x,this.bounds.y);ctx.lineTo(this.bounds.x+this.bounds.width,this.bounds.y);ctx.lineTo(this.bounds.x+this.bounds.width,this.bounds.y+this.bounds.height);ctx.lineTo(this.bounds.x,this.bounds.y+this.bounds.height);ctx.closePath();ctx.stroke();ctx.restore();}}});});

// lib/game/ui-two-state-button.js
ig.baked=true;ig.module('game.ui-two-state-button').requires('impact.game','impact.font','game.ui-hotbox').defines(function(){TwoStateButton=HotBox.extend({imageUp:null,imageDown:null,releaseCallback:null,releaseData:null,bUp:true,init:function(x,y,width,height,settings){this.parent(x,y,width,height,settings);this.imageUp=settings.imageUp||null;this.imageDown=settings.imageDown||null;this.releaseCallback=settings.releaseCallback||null;this.releaseData=settings.releaseData||null;},pressed:function(x,y){this.parent(x,y);this.bUp=false;},released:function(x,y){this.bUp=true;if(this.releaseCallback){this.releaseCallback(this.releaseData);}},draw:function(){var xCenter=this.bounds.x+this.bounds.width/2;var yCenter=this.bounds.y+this.bounds.height/2;if(this.bUp&&this.imageUp){this.imageUp.draw(xCenter-this.imageUp.width/2,yCenter-this.imageUp.height/2);}
else if(!this.bUp&&this.imageDown){this.imageDown.draw(xCenter-this.imageDown.width/2,yCenter-this.imageDown.height/2);}}});});

// lib/game/game-level.js
ig.baked=true;ig.module('game.game-level').requires('impact.game','impact.font','game.base-level','game.ui-tilt-button','game.ui-hotbox','game.ui-two-state-button').defines(function(){GameLevel=BaseLevel.extend({dukeImages:[new ig.Image('media/art/duke-unavailable.png'),new ig.Image('media/art/duke-ready.png'),new ig.Image('media/art/duke-selected.png'),],avaImages:[new ig.Image('media/art/ava-unavailable.png'),new ig.Image('media/art/ava-ready.png'),new ig.Image('media/art/ava-selected.png'),],dukeSelector:null,avaSelector:null,init:function(){if(GameLevel._buttonBack===null){GameLevel.CreateGameLevelButtons();}
if(GameLevel._dpadBtns.length===0){GameLevel.CreateDPadButtons();}
this.dukeSelector=new HotBox(this.getDukeSelImageX(GameLevel.ACTOR_SELECT_STATES.SELECTED),this.getDukeSelImageY(GameLevel.ACTOR_SELECT_STATES.SELECTED),this.dukeImages[GameLevel.ACTOR_SELECT_STATES.SELECTED].width,this.dukeImages[GameLevel.ACTOR_SELECT_STATES.SELECTED].height,{onPressSound:ig.Game.sndButton,pressCallback:ig.Game.ActivateDuke});this.addWidget(this.dukeSelector);this.avaSelector=new HotBox(this.getAvaSelImageX(GameLevel.ACTOR_SELECT_STATES.SELECTED),this.getAvaSelImageY(GameLevel.ACTOR_SELECT_STATES.SELECTED),this.avaImages[GameLevel.ACTOR_SELECT_STATES.SELECTED].width,this.avaImages[GameLevel.ACTOR_SELECT_STATES.SELECTED].height,{onPressSound:ig.Game.sndButton,pressCallback:ig.Game.ActivateAva});this.addWidget(this.avaSelector);this.widgetList.push(GameLevel._buttonBack);this.widgetList.push(GameLevel._buttonSkip);this.widgetList.push(GameLevel._buttonQuit);this.widgetList.push(GameLevel._buttonRetry);for(var i=1;i<GameLevel._dpadImages.length;++i){this.addWidget(GameLevel._dpadBtns[i-1]);}},drawWidgets:function(){},postDrawWidgets:function(){this.drawAllWidgets();},getDukeSelImageX:function(imageIndex){return GameLevel.xCenter-this.dukeImages[imageIndex].width/2;},getDukeSelImageY:function(imageIndex){return 3*Constants.TILE_DY/2-this.dukeImages[imageIndex].height/2;},getAvaSelImageX:function(imageIndex){return GameLevel.xCenter-this.avaImages[imageIndex].width/2;},getAvaSelImageY:function(imageIndex){return 5*Constants.TILE_DY-this.avaImages[imageIndex].height/2;},draw:function(){this.parent();if(GameLevel._dpadImages[0]&&GameLevel._buttonSkip){var x=GameLevel.xCenter-GameLevel._dpadImages[0].width/2;var y=GameLevel.yBottom-GameLevel._dpadImages[0].height;GameLevel._dpadImages[0].draw(x,y);var imageIndex=GameLevel.ACTOR_SELECT_STATES.READY;var actorImage=this.dukeImages[GameLevel.ACTOR_SELECT_STATES.READY];if(this.duke){if(this.activeActor===this.duke){imageIndex=GameLevel.ACTOR_SELECT_STATES.SELECTED;actorImage=this.dukeImages[GameLevel.ACTOR_SELECT_STATES.SELECTED];}}
else{imageIndex=GameLevel.ACTOR_SELECT_STATES.UNAVAILABLE;actorImage=this.dukeImages[GameLevel.ACTOR_SELECT_STATES.UNAVAILABLE];}
actorImage.draw(this.getDukeSelImageX(imageIndex),this.getDukeSelImageY(imageIndex));imageIndex=GameLevel.ACTOR_SELECT_STATES.READY;actorImage=this.avaImages[GameLevel.ACTOR_SELECT_STATES.READY];if(this.ava){if(this.activeActor===this.ava){imageIndex=GameLevel.ACTOR_SELECT_STATES.SELECTED;actorImage=this.avaImages[GameLevel.ACTOR_SELECT_STATES.SELECTED];}}
else{imageIndex=GameLevel.ACTOR_SELECT_STATES.UNAVAILABLE;actorImage=this.avaImages[GameLevel.ACTOR_SELECT_STATES.UNAVAILABLE];}
actorImage.draw(this.getAvaSelImageX(imageIndex),this.getAvaSelImageY(imageIndex));if(false){for(var i=0;i<GameLevel._dpadBtns.length;++i){var ctx=ig.system.context;ctx.save();ctx.lineWidth=2;ctx.strokeStyle="#00FF00";ctx.fillStyle="#00FFFF";var bounds=GameLevel._dpadBtns[i].getBoundsRef();ctx.beginPath();ctx.moveTo(bounds.x,bounds.y);ctx.lineTo(bounds.x+bounds.width,bounds.y);ctx.lineTo(bounds.x+bounds.width,bounds.y+bounds.height);ctx.lineTo(bounds.x,bounds.y+bounds.height);ctx.closePath();ctx.fill();ctx.stroke();ctx.restore();}}}
this.postDrawWidgets();},resetLevel:function(){this.initLevel(this.geometry,this.hints,Constants.TEXT_TUTORIAL_VICTORY,Constants.VICTORY_MSG_DURATION,ig.Game._game.nextLevel.bind(ig.Game._game));GameLevel._currentLevel=this;}});GameLevel._currentLevel=null;GameLevel._buttonImages=[new ig.Image('media/art/ui_unskip.png'),new ig.Image('media/art/ui_skip.png'),new ig.Image('media/art/ui_quit.png'),new ig.Image('media/art/ui_retry.png'),];GameLevel._dpadImages=[new ig.Image('media/art/d-pad.png'),new ig.Image('media/art/dpad-up.png'),new ig.Image('media/art/dpad-right.png'),new ig.Image('media/art/dpad-down.png'),new ig.Image('media/art/dpad-left.png'),];GameLevel._buttonBack=null;GameLevel._buttonSkip=null;GameLevel._buttonQuit=null;GameLevel._buttonRetry=null;GameLevel._dpadBtns=[];GameLevel._dpadBtnOffsets=[{x:81,y:161-127},{x:130,y:161-81},{x:81,y:147-21},{x:33,y:161-81},];GameLevel.CreateDPadButtons=function(){if(GameLevel._dpadImages[0]){var x=GameLevel.xCenter-GameLevel._dpadImages[0].width/2;var y=GameLevel.yBottom-GameLevel._dpadImages[0].height
for(var i=1;i<GameLevel._dpadImages.length;++i){var btnX=x+GameLevel._dpadBtnOffsets[i-1].x-GameLevel._dpadImages[i].width/2;var btnY=y+GameLevel._dpadBtnOffsets[i-1].y-GameLevel._dpadImages[i].height/2;GameLevel._dpadBtns.push(new TwoStateButton(btnX,btnY,GameLevel._dpadImages[i].width,GameLevel._dpadImages[i].height,{pressCallback:GameLevel.OnDPadButtonPressed,pressData:""+(i-1),imageUp:null,imageDown:GameLevel._dpadImages[i],releaseCallback:null,releaseData:null}));}}};GameLevel.OnDPadButtonPressed=function(pressData){if(GameLevel._currentLevel){var direction=parseInt(pressData);ig.Game.QueueCommand(direction);GameLevel._currentLevel.updateInput();}};GameLevel.OnTiltButtonActivate=function(cmd){if(cmd==="back"){ig.Game._game.prevLevel();}
else if(cmd==="skip"){ig.Game._game.nextLevel();}
else if(cmd==="quit"){ig.Game._game.quitLevel();}
else if(cmd==="retry"){ig.Game._game.startLevel();}},GameLevel.CreateGameLevelButtons=function(){var buttonSettings={onPressSound:ig.Game.sndButton,image:GameLevel._buttonImages[0],tiltAngle:Constants.TILT_ANGLE,tiltTime:Constants.TILT_TIME,fnTrigger:GameLevel.OnTiltButtonActivate,triggerData:"back"};var leftEdge=Constants.OFFSET_X+Constants.COLS*Constants.TILE_DX;var rightWidth=Constants.WIDTH-leftEdge;var leftCol=leftEdge+buttonSettings.image.width*2*Constants.TILT_BUTTON_SPACER;var rightCol=Constants.WIDTH-buttonSettings.image.width*(1+Constants.TILT_BUTTON_SPACER);var bottomRow=Constants.HEIGHT-buttonSettings.image.height*(1+2*Constants.TILT_BUTTON_SPACER);var topRow=bottomRow-(1+Constants.TILT_BUTTON_SPACER)*buttonSettings.image.height;GameLevel._buttonBack=new TiltButton(leftCol,topRow,buttonSettings);buttonSettings.image=GameLevel._buttonImages[1];buttonSettings.triggerData="skip";GameLevel._buttonSkip=new TiltButton(rightCol,topRow,buttonSettings);buttonSettings.image=GameLevel._buttonImages[2];buttonSettings.triggerData="quit";GameLevel._buttonQuit=new TiltButton(leftCol,bottomRow,buttonSettings);buttonSettings.image=GameLevel._buttonImages[3];buttonSettings.triggerData="retry";GameLevel._buttonRetry=new TiltButton(rightCol,bottomRow,buttonSettings);var leftEdge=2*Constants.OFFSET_X+Constants.COLS*Constants.TILE_DX;var rightWidth=Constants.WIDTH-leftEdge;GameLevel.xCenter=leftEdge+rightWidth/2;GameLevel.yBottom=GameLevel._buttonSkip.getBoundsRef().y-Constants.TILE_DY/2;};GameLevel.xCenter=0;GameLevel.xBottom=0;GameLevel.ACTOR_SELECT_STATES={UNAVAILABLE:0,READY:1,SELECTED:2};});

// lib/game/level-tutorial-01.js
ig.baked=true;ig.module('game.level-tutorial-01').requires('game.game-level','impact.game','impact.font').defines(function(){LevelTutorial01=GameLevel.extend({geometry:["...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","._._._._._._._..._._._._._.","|*.*.*.*.*.*.*.2.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.1.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","._._._._._._._._._._._._._.",],hints:["Welcome to Steps! Click here for instructions...","Use Duke (the black horse) to herd other horses...","Herd them through holes in the top fence...","Then watch them follow the road to Happy Valley...","Press the 'up' key to try it out.",],});});

// lib/game/level-tutorial-02.js
ig.baked=true;ig.module('game.level-tutorial-02').requires('game.game-level','impact.game','impact.font').defines(function(){LevelTutorial02=GameLevel.extend({geometry:["...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","._._._._._._._..._._._._._.","|*.*.*.*.*.*.*.2.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","..............._...........","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.1.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","._._._._._._._._._._._._._.",],hints:["Duke will jump fences as he moves...","Press the 'up' key and watch him go!",],});});

// lib/game/level-tutorial-03.js
ig.baked=true;ig.module('game.level-tutorial-03').requires('game.game-level','impact.game','impact.font').defines(function(){LevelTutorial03=GameLevel.extend({geometry:["...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","._._._._._._._..._._._._._.","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.2.*.*.*.*.*|","...............-...........","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.1.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","._._._._._._._._._._._._._.",],hints:["Some fences are too tall for Duke to jump...","Luckily, he can still herd horses close to the fence...","Press the 'up' key to see how this works."],});});

// lib/game/level-tutorial-04.js
ig.baked=true;ig.module('game.level-tutorial-04').requires('game.game-level','impact.game','impact.font').defines(function(){LevelTutorial04=GameLevel.extend({geometry:["...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","._._._._._._._._._._..._._.","|*.*.*.*.*.*.*.*.*.*.*|*.*|","....................._.....","|*.*.*.*.*.*.*.2.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.1.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","._._._._._._._._._._._._._.",],hints:["When horses hit a barrier, they change direction...","Horses with solid coats turn right first...","If they can't turn right, they turn left...","Press the 'up' arrow to see it happen."],});});

// lib/game/level-tutorial-05.js
ig.baked=true;ig.module('game.level-tutorial-05').requires('game.game-level','impact.game','impact.font').defines(function(){LevelTutorial05=GameLevel.extend({geometry:["...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","._._._._..._._._._._._._._.","|*.*.*.*|*.*.*.*.*.*.*.*.*|","........._.................","|*.*.*.*.*.*.*.3.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.1.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","._._._._._._._._._._._._._.",],hints:["Pintos (spotted horses) turn left first...","If they can't turn left, they turn right...","Press the 'up' key and watch how the horse moves."],});});

// lib/game/level-tutorial-06.js
ig.baked=true;ig.module('game.level-tutorial-06').requires('game.game-level','impact.game','impact.font').defines(function(){LevelTutorial06=GameLevel.extend({geometry:["...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","._._._._._._._..._._._._._.","|*.*.*.*.*.*.*.2.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","............._._._.........","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.4.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","._._._._._._._._._._._._._.",],hints:["Sometimes, Ava rides along to help Duke...","Ava's mare doesn't like jumping fences...","Move around the fence and rescue the other horse.",],});});

// lib/game/level-tutorial-07.js
ig.baked=true;ig.module('game.level-tutorial-07').requires('game.game-level','impact.game','impact.font').defines(function(){LevelTutorial07=GameLevel.extend({geometry:["...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","._._._._._._._..._._._._._.","|*.*.*.*.*.*.*.2.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","............._.l._.........","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.4.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","._._._._._._._._._._._._._.",],hints:["Sometimes you'll find steel gates...","Duke can't open them, but Ava can...","Just move her into the gate to open it...","Press 'up' to try it."],});});

// lib/game/level-basic-01.js
ig.baked=true;ig.module('game.level-basic-01').requires('game.game-level','impact.game','impact.font').defines(function(){LevelBasic01=GameLevel.extend({geometry:["...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","..........._._._._.........",".*.*.*.*|*.*.*.*.*|*.*.*.*.","...........................",".*.*.*.*|*.*.2.*.*|*.*.*.*.","...........................",".*.*.*.*|*.*.*.*.*|*.*.*.*.","...........................",".*.*.*.*|*.*.*.1.*|*.*.*.*.","........._._._._._.........",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",],hints:["Let's start with one of Whiplash's small corrals.",],});});

// lib/game/level-basic-02.js
ig.baked=true;ig.module('game.level-basic-02').requires('game.game-level','impact.game','impact.font').defines(function(){LevelBasic02=GameLevel.extend({geometry:["...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","........._._._._...........",".*.*.*.*|*.*.1.*.*|*.*.*.*.","...........................",".*.*.*.*|*.*.*.*.*|*.*.*.*.","...........................",".*.*.*.*|*.2.*.*.*|*.*.*.*.","...........................",".*.*.*.*|*.*.*.*.*|*.*.*.*.","........._._._._._.........",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",],hints:["This looks familiar, but it's a little tricky.",],});});

// lib/game/level-basic-03.js
ig.baked=true;ig.module('game.level-basic-03').requires('game.game-level','impact.game','impact.font').defines(function(){LevelBasic03=GameLevel.extend({geometry:["...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","........._._._._...........",".*.*.*.*|*.*.*.*.*|*.*.*.*.","...........................",".*.*.*.*|*.1.2.*.*|*.*.*.*.","...........................",".*.*.*.*|*.*.*.*.*|*.*.*.*.","...........................",".*.*.*.*|*.*.*.*.*|*.*.*.*.","........._._._._...........",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",],hints:["A horse that leaves the bottom or sides is 'lost'...","If you lose a horse, you have to start over."],});});

// lib/game/level-basic-04.js
ig.baked=true;ig.module('game.level-basic-04').requires('game.game-level','impact.game','impact.font').defines(function(){LevelBasic04=GameLevel.extend({geometry:["...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","........._._._._...........",".*.*.*.*|*.*.*.2.*|*.*.*.*.","...........................",".*.*.*.*|*.1.*.*.*|*.*.*.*.","...........................",".*.*.*.*|*.*.*.*.*|*.*.*.*.","........._._...............",".*.*.*.*.*.*|*.3.*|*.*.*.*.","............._._...........",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",],hints:["Don't let Mr. Whiplash have those horses!"],});});

// lib/game/level-basic-05.js
ig.baked=true;ig.module('game.level-basic-05').requires('game.game-level','impact.game','impact.font').defines(function(){LevelBasic05=GameLevel.extend({geometry:["...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","........._._..._._.........",".*.*.*.*|*.*.*.*.*|*.*.*.*.",".............-.............",".*.*.*.*|*.*]*]*.*|*.*.*.*.",".............-.............",".*.*.*.*|*.2.*.3.*|*.*.*.*.","...........................",".*.*.*.*|*.*.*.1.*|*.*.*.*.","........._._._._._.........",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",],hints:["Sometimes, when you're herding...","The best thing you can do is stand still.",],});});

// lib/game/level-basic-06.js
ig.baked=true;ig.module('game.level-basic-06').requires('game.game-level','impact.game','impact.font').defines(function(){LevelBasic06=GameLevel.extend({geometry:["...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","..........._..._...........",".*.*.*.*.*|*.*.*|*.*.*.*.*.","........._......._.........",".*.*.*.*|*.*.*.*.*|*.*.*.*.","...........................",".*.*.*.*|*.1.*.*.*|*.*.*.*.","................._.........",".*.*.*.*|*.*.*.*|*.*.*.*.*.","........._._..._...........",".*.*.*.*.*.*|2|*.*.*.*.*.*.","............._.............",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",],hints:["You'll need to think outside the box to solve this one!"],});});

// lib/game/level-basic-07.js
ig.baked=true;ig.module('game.level-basic-07').requires('game.game-level','impact.game','impact.font').defines(function(){LevelBasic07=GameLevel.extend({geometry:["...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","......._._._..._._._.......",".*.*.*|*.*.*.*.*.*.*|*.*.*.","...........................",".*.*.*|*.*.*.*.*.*.*|*.*.*.","...........................",".*.*.*|*.*.1.*.*.*.*|*.*.*.","...........................",".*.*.*|*.*.*.*.*.*.*|*.*.*.","......._._._._._._........",".*.*.*|3.2.2.2.2.2.*|*.*.*.","......._._._._._._._.......",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",],hints:["What a line! It's like they're waiting at the Post Office!"],});});

// lib/game/level-basic-08.js
ig.baked=true;ig.module('game.level-basic-08').requires('game.game-level','impact.game','impact.font').defines(function(){LevelBasic08=GameLevel.extend({geometry:["...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.",".......-.-.-.-.-.-.-.......",".*.*.*.*.1.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.2.*.*.*.*.*.*|*.","...........................",".*|*.*.*.*.*.*.3.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","..........................",".*.*.*]*.*.*.*.*.*.*]*.*.*.",".......-.-.-.-.-.-.-.......",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",],hints:["I wonder what those two little sections of fence are for?"],});});

// lib/game/level-basic-09.js
ig.baked=true;ig.module('game.level-basic-09').requires('game.game-level','impact.game','impact.font').defines(function(){LevelBasic09=GameLevel.extend({geometry:["...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","..........._._._._._.......",".*.*.*|*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*|*.*.","....................._.....",".*.*.*|*.*.1.*.*|3.2|*.*.*.","......._...................",".*.*.*.*.*.*.*.*|3.2|*.*.*.","..........._._._...........",".*.*.*.*.*.*.*.*|3.2|*.*.*.","................._._.......",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",],hints:["This one looks tough. Better be careful.",],});});

// lib/game/level-basic-10.js
ig.baked=true;ig.module('game.level-basic-10').requires('game.game-level','impact.game','impact.font').defines(function(){LevelBasic10=GameLevel.extend({geometry:["...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","....._._._._._._...........",".*.*.*|*.*.*.*.2.*|*.*.*.*.","...........................",".*.*|*.*|*.1.*|*.*.*.*.*.*.","...........................",".*.*|*.*.*.*.*.*.2|*.*.*.*.","..........._...............",".*.*|*.*.*.*|*.6.*|*.*.*.*.","............._._...........",".*.*|*.5.*.*.*.*.*.*.*.*.*.","...........................",".*.*|*.*|*.*.*.*.*.*.*.*.*.","....._._..._._.............",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",],hints:["I can't believe he'd leave all these horses...","In such a broken down corral...","Take care not to lose anyone!",],});});

// lib/game/level-ava-01.js
ig.baked=true;ig.module('game.level-ava-01').requires('game.game-level','impact.game','impact.font').defines(function(){LevelAva01=GameLevel.extend({geometry:["...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","........._..._..._.........",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........r._.l...........",".*.*.*.*.*|*.4.*|*.*.*.*.*.","..........._._._...........",".*.*.*.*|*.2.*.3.*|*.*.*.*.","........._._._._._.........",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",],hints:["What a strange corral. Should we be worried?",],});});

// lib/game/level-ava-02.js
ig.baked=true;ig.module('game.level-ava-02').requires('game.game-level','impact.game','impact.font').defines(function(){LevelAva02=GameLevel.extend({geometry:["...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","....._._._._._._.r._.......",".*.*|*.2.*.4.*.*.*.*.*.*.*.","...........................",".*.*|*.*.*.*.*.*.2.*.*.*.*.",".....l..._.................",".*.*.*.*.*.*.*.6.*|*.*.*.*.","............._._._.........",".*.*.*.5.*.*|*.*.*.*.*.*.*.","...........................",".*.*|*.*.*.*t*.*.*.*.*.*.*.","....._.....................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",],hints:["So many gates! I wonder which one is most important?"],});});

// lib/game/level-both-01.js
ig.baked=true;ig.module('game.level-both-01').requires('game.game-level','impact.game','impact.font').defines(function(){LevelBoth01=GameLevel.extend({geometry:["...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","._._._._..._._._._._._._._.",".*.*.5.*.*.*.*.*.*.*.*.*.*.",".r.........................",".*|*.3.*.*.4.*.*.*.*.*.*.*.","..._._.....................",".*.*.*.*.*.*.*|2.*.*.*.*.*.","........._.l._.............",".*.*.*.*.*.*.*.*.*.*b*.*.*.","...........................",".*.*.*...*.*.1.*.*.*|*.*.*.","...........................",".*.*.*.*.2.6.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","...........................",],hints:["Click on Ava or Duke when you want to move them."],});});

// lib/game/smart-sound.js
ig.baked=true;ig.module('game.smart-sound').requires('impact.game','impact.font').defines(function(){SmartSound=ig.Class.extend({sound:null,replayDelay:0,lastPlayed:-1,init:function(sound,replayDelay){this.sound=sound;this.replayDelay=replayDelay;},reset:function(){this.lastPlayed=-1;},play:function(){if(this.sound){var playTime=(new Date()).getTime();if(this.lastPlayed<0||(playTime-this.lastPlayed)*0.001>this.replayDelay){this.lastPlayed=playTime;this.sound.play();}}},stop:function(){if(this.sound){this.sound.stop();}},setVolume:function(volume){if(this.sound){this.sound.volume=volume;}}});});

// lib/game/demo-level.js
ig.baked=true;ig.module('game.demo-level').requires('impact.game','impact.font','game.base-level','game.ui-tilt-button','game.ui-hotbox').defines(function(){DemoLevel=BaseLevel.extend({titleStripe:new ig.Image('media/art/demo-stripe.png'),titleImage:new ig.Image('media/art/title.png'),geometry:["...........................",".*.*.*.*.*.*.*.*.*.*.*.*.*.","._._._._._._._._._._._._._.","|*.*.*.*.*.*.*.*.*.5.*.*.*|","...........................","|*.*.*.*.*.2.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.1.*.*.*.*.*.2.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.6.*.*.*.*.*.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.3.*.*.*.*.*.*|","...........................","|*.*.*.*.*.*.*.*.*.*.*.*.*|","._._._._._._._._._._._._._.",],hints:[],state:Constants.DEMO_STATE.NONE,levelInfo:null,levelHotBox:[],init:function(levelInfo){DemoLevel._demoLevel=this;this.levelInfo=levelInfo;if(DemoLevel._buttonLearn===null){DemoLevel.CreateDemoLevelButtons();}
var maxLevels=0;for(var i=0;this.levelInfo&&i<this.levelInfo.length;++i){if(this.levelInfo[i].length>maxLevels){maxLevels=this.levelInfo[i].length;}}
var boxWidth=ig.Game._font.widthForString(Constants.DEFAULT_TEXT_WIDTH);var boxHeight=ig.Game._font.height*(1+Constants.TILT_BUTTON_SPACER);var x=DemoLevel._plaquePos.x-DemoLevel._plaqueMode.width/2+boxWidth/2;var y=DemoLevel._plaquePos.y+DemoLevel._plaqueMode.height/2-boxHeight/2;for(var i=0;i<maxLevels;++i){var xOffset=(i%5)*DemoLevel.HOTBOX_OFFSET_X;x+=xOffset;this.levelHotBox.push(new HotBox(x,y,boxWidth,boxHeight,{onPressSound:ig.Game.sndButton,pressCallback:this.onHotBoxPressed.bind(this),pressData:(""+i)}));x-=xOffset;y+=boxHeight*(1+Constants.TILT_BUTTON_SPACER);}
this.addWidgets();},updateGallopLoop:function(){},startGallopLoop:function(){},onHotBoxPressed:function(hotBoxData){var boxId=parseInt(hotBoxData);if(boxId>=0&&boxId<this.levelInfo[this.state].length){ig.Game._game.startLevelInTier(boxId,this.state);}},addWidgets:function(){this.widgetList.push(DemoLevel._buttonLearn);this.widgetList.push(DemoLevel._buttonDuke);this.widgetList.push(DemoLevel._buttonAva);this.widgetList.push(DemoLevel._buttonBoth);},addHotBoxes:function(){for(var i=0;i<this.levelHotBox.length;++i){this.widgetList.push(this.levelHotBox[i]);this.levelHotBox[i].activate();}},removeWidgets:function(){this.widgetList.erase(DemoLevel._buttonLearn);this.widgetList.erase(DemoLevel._buttonDuke);this.widgetList.erase(DemoLevel._buttonAva);this.widgetList.erase(DemoLevel._buttonBoth);},removeHotBoxes:function(){for(var i=0;i<this.levelHotBox.length;++i){this.widgetList.erase(this.levelHotBox[i]);this.levelHotBox[i].deactivate();}},showComingSoonMessage:function(){ig.Game.FlushMessages();ig.Game.AddMessage(Constants.TEXT_LEVELS_DONT_EXIST,null,Constants.VICTORY_MSG_DURATION,null);},chooseTutorialLevel:function(){if(this.levelInfo&&this.levelInfo[Constants.DEMO_STATE.CHOOSE_TUTORIAL_LEVEL].length){this.state=Constants.DEMO_STATE.CHOOSE_TUTORIAL_LEVEL;this.removeWidgets();this.addHotBoxes();}
else{this.showComingSoonMessage();}},chooseDukeLevel:function(){if(this.levelInfo&&this.levelInfo[Constants.DEMO_STATE.CHOOSE_DUKE_LEVEL].length){this.state=Constants.DEMO_STATE.CHOOSE_DUKE_LEVEL;this.removeWidgets();this.addHotBoxes();}
else{this.showComingSoonMessage();}},chooseAvaLevel:function(){if(this.levelInfo&&this.levelInfo[Constants.DEMO_STATE.CHOOSE_AVA_LEVEL].length){this.state=Constants.DEMO_STATE.CHOOSE_AVA_LEVEL;this.removeWidgets();this.addHotBoxes();}
else{this.showComingSoonMessage();}},chooseBothLevel:function(){if(this.levelInfo&&this.levelInfo[Constants.DEMO_STATE.CHOOSE_BOTH_LEVEL].length){this.state=Constants.DEMO_STATE.CHOOSE_BOTH_LEVEL;this.removeWidgets();this.addHotBoxes();}
else{this.showComingSoonMessage();}},enterIntroState:function(){if(this.state!==Constants.DEMO_STATE.INTRO){this.state=Constants.DEMO_STATE.INTRO;this.removeHotBoxes();this.addWidgets();}},resetLevel:function(){this.parent();this.initLevel(this.geometry,this.hints,Constants.TEXT_TUTORIAL_VICTORY,Constants.VICTORY_MSG_DURATION,ig.Game._game.nextLevel.bind(ig.Game._game));this.addRandomFences();this.removeWidgets();this.enterIntroState();},onPress:function(x,y){var bConsumed=this.parent(x,y);if(!bConsumed){this.enterIntroState();}
return true;},updateInput:function(){while(ig.Game.CommandReady()){var cmd=ig.Game.UnqueueCommand();}},update:function(){if(Math.random()<DemoLevel.RANDOM_MOVE_CHANCE*ig.Game._dt){var randomAnimal=this.duke;if(Math.random()>DemoLevel.DUKE_MOVE_CHANCE){var animalIndex=Math.floor(Math.random()*this.animals.length);randomAnimal=this.animals[animalIndex];}
if(randomAnimal.isMoving()){randomAnimal.setDirection(Constants.DIRECTION.BLOCKED);}
else{var moveDir=Math.floor(Math.random()*(Constants.DIRECTION.LEFT+1));randomAnimal.setDirection(moveDir);}}
this.parent();},drawWidgets:function(){},postDrawWidgets:function(){this.drawAllWidgets();},draw:function(){this.parent();if(this.titleStripe){this.titleStripe.draw(0,Constants.HEIGHT/2-this.titleStripe.height/2);}
if(this.titleImage){var leftEdge=Constants.OFFSET_X+Constants.COLS*Constants.TILE_DX;this.titleImage.draw(leftEdge/2-this.titleImage.width/2,Constants.HEIGHT/2-this.titleImage.height/2);}
switch(this.state){case Constants.DEMO_STATE.INTRO:{if(DemoLevel._plaqueMode){DemoLevel._plaqueMode.draw(DemoLevel._plaquePos.x-DemoLevel._plaqueMode.width/2,DemoLevel._plaquePos.y-DemoLevel._plaqueMode.height/2);}
break;}
default:{if(DemoLevel._plaqueMode){DemoLevel._plaqueLevel.draw(DemoLevel._plaquePos.x-DemoLevel._plaqueMode.width/2,DemoLevel._plaquePos.y-DemoLevel._plaqueMode.height/2);}
var ctx=ig.system.context;ctx.save();ctx.lineWidth=2;var nLevels=this.levelInfo&&(typeof(this.levelInfo[this.state])!=='undefined')?this.levelInfo[this.state].length:0;for(var i=0;i<nLevels;++i){var bounds=this.levelHotBox[i].getBoundsRef();var x=bounds.x;var y=bounds.y;var boxWidth=bounds.width;var boxHeight=bounds.height;x+=Constants.DROPSHADOW_OFFSET_X;y+=Constants.DROPSHADOW_OFFSET_Y;ctx.strokeStyle=Constants.DROPSHADOW_STROKE;ctx.fillStyle=Constants.DROPSHADOW_FILL;ctx.globalAlpha=Constants.DROPSHADOW_ALPHA;ctx.beginPath();ctx.moveTo(x,y);ctx.lineTo(x+boxWidth,y);ctx.lineTo(x+boxWidth,y+boxHeight);ctx.lineTo(x,y+boxHeight);ctx.closePath();ctx.fill();ctx.stroke();x-=Constants.DROPSHADOW_OFFSET_X;y-=Constants.DROPSHADOW_OFFSET_Y;ctx.strokeStyle=Constants.STROKE_PURPLE;ctx.fillStyle=Constants.FILL_PURPLE;ctx.globalAlpha=1;ctx.beginPath();ctx.moveTo(x,y);ctx.lineTo(x+boxWidth,y);ctx.lineTo(x+boxWidth,y+boxHeight);ctx.lineTo(x,y+boxHeight);ctx.closePath();ctx.fill();ctx.stroke();ig.Game._font.draw("Level "+(i+1),x+boxWidth/2,y+boxHeight/8,ig.Font.ALIGN.CENTER);}
ctx.restore();break;}}
this.postDrawWidgets();}});DemoLevel._plaquePos={x:910,y:97};DemoLevel._plaqueMode=new ig.Image('media/art/plaque-pick-mode.png');DemoLevel._plaqueLevel=new ig.Image('media/art/plaque-pick-level.png');DemoLevel._buttonImages=[new ig.Image('media/art/tilt-btn-learn.png'),new ig.Image('media/art/tilt-btn-duke.png'),new ig.Image('media/art/tilt-btn-ava.png'),new ig.Image('media/art/tilt-btn-both.png'),];DemoLevel._buttonLearn=null;DemoLevel._buttonDuke=null;DemoLevel._buttonAva=null;DemoLevel._buttonBoth=null;DemoLevel._demoLevel=null;DemoLevel.OnTiltButtonActivate=function(cmd){if(DemoLevel._demoLevel){if(cmd==="learn"){DemoLevel._demoLevel.chooseTutorialLevel();}
else if(cmd==="duke"){DemoLevel._demoLevel.chooseDukeLevel();}
else if(cmd==="ava"){DemoLevel._demoLevel.chooseAvaLevel();}
else if(cmd==="both"){DemoLevel._demoLevel.chooseBothLevel();}}},DemoLevel.CreateDemoLevelButtons=function(){var buttonSettings={onPressSound:ig.Game.sndButton,image:DemoLevel._buttonImages[0],tiltAngle:Constants.TILT_ANGLE,tiltTime:Constants.TILT_TIME,fnTrigger:DemoLevel.OnTiltButtonActivate,triggerData:"learn"};var x=DemoLevel._plaquePos.x-DemoLevel._plaqueMode.width/4;var plaqueBottom=DemoLevel._plaquePos.y+2*DemoLevel._plaqueMode.height/5;var spaceY=Constants.HEIGHT-plaqueBottom;var btnSpacerY=DemoLevel._buttonImages[0].height*(1+Constants.TILT_BUTTON_SPACER);var btnSlackY=spaceY-4*btnSpacerY;var btnOffsetY=Math.max(0,btnSlackY/2);var y=plaqueBottom+btnOffsetY;DemoLevel._buttonLearn=new TiltButton(x,y,buttonSettings);y+=btnSpacerY;buttonSettings.image=DemoLevel._buttonImages[1];buttonSettings.triggerData="duke";DemoLevel._buttonDuke=new TiltButton(x,y,buttonSettings);y+=btnSpacerY;buttonSettings.image=DemoLevel._buttonImages[2];buttonSettings.triggerData="ava";DemoLevel._buttonAva=new TiltButton(x,y,buttonSettings);y+=btnSpacerY;buttonSettings.image=DemoLevel._buttonImages[3];buttonSettings.triggerData="both";DemoLevel._buttonBoth=new TiltButton(x,y,buttonSettings);};DemoLevel.RANDOM_MOVE_CHANCE=1;DemoLevel.DUKE_MOVE_CHANCE=1/20;DemoLevel.HOTBOX_OFFSET_X=10;});

// lib/game/main.js
ig.baked=true;ig.module('game.main').requires('impact.game','impact.font','game.math-utils','game.constants','game.level-tutorial-01','game.level-tutorial-02','game.level-tutorial-03','game.level-tutorial-04','game.level-tutorial-05','game.level-tutorial-06','game.level-tutorial-07','game.level-basic-01','game.level-basic-02','game.level-basic-03','game.level-basic-04','game.level-basic-05','game.level-basic-06','game.level-basic-07','game.level-basic-08','game.level-basic-09','game.level-basic-10','game.level-ava-01','game.level-ava-02','game.level-both-01','game.smart-sound','game.demo-level').defines(function(){Steps=ig.Game.extend({clearColor:'#008800',curTime:0,msgTimer:0,fadeDir:-1,curMsg:null,levelIndex:0,tierIndex:Constants.TIER.DEMO,physicsTime:0,demoLevel:null,bWasMouseDown:false,soundButton:new ig.Sound('media/sound/button-press.mp3'),soundTheme:new ig.Sound('media/sound/title-theme.mp3'),soundBlow:new ig.Sound('media/sound/horse-blow-lips.mp3'),soundHuff:new ig.Sound('media/sound/horse-huff.mp3'),soundNeigh:new ig.Sound('media/sound/horse-neigh.mp3'),soundGate:new ig.Sound('media/sound/metal-gate.mp3'),bAdvancedDuringCallback:false,levels:[[],[],[],[],],currentLevel:null,background:new ig.Image('media/art/background.png'),font:new ig.Font('media/art/font-yonder.png'),initSounds:function(){ig.Game.sndButton=new SmartSound(this.soundButton,0);ig.Game.sndTheme=new SmartSound(this.soundTheme,0);ig.Game.sndBlow=new SmartSound(this.soundBlow,Constants.DEFAULT_REPLAY_DELAY);ig.Game.sndHuff=new SmartSound(this.soundHuff,Constants.DEFAULT_REPLAY_DELAY);ig.Game.sndNeigh=new SmartSound(this.soundNeigh,Constants.NEIGH_REPLAY_DELAY);ig.Game.sndGate=new SmartSound(this.soundGate,Constants.DEFAULT_REPLAY_DELAY);},fillLevelArray:function(){this.levels[0].unshift(new LevelTutorial07());this.levels[0].unshift(new LevelTutorial06());this.levels[0].unshift(new LevelTutorial05());this.levels[0].unshift(new LevelTutorial04());this.levels[0].unshift(new LevelTutorial03());this.levels[0].unshift(new LevelTutorial02());this.levels[0].unshift(new LevelTutorial01());this.levels[1].unshift(new LevelBasic10());this.levels[1].unshift(new LevelBasic09());this.levels[1].unshift(new LevelBasic08());this.levels[1].unshift(new LevelBasic07());this.levels[1].unshift(new LevelBasic06());this.levels[1].unshift(new LevelBasic05());this.levels[1].unshift(new LevelBasic04());this.levels[1].unshift(new LevelBasic03());this.levels[1].unshift(new LevelBasic02());this.levels[1].unshift(new LevelBasic01());this.levels[2].unshift(new LevelAva02());this.levels[2].unshift(new LevelAva01());this.levels[3].unshift(new LevelBoth01());this.demoLevel=new DemoLevel(this.levels);},initInput:function(){ig.input.initMouse();ig.input.bind(ig.KEY.MOUSE1,'onPress');ig.input.bind(ig.KEY.LEFT_ARROW,'left');ig.input.bind(ig.KEY.RIGHT_ARROW,'right');ig.input.bind(ig.KEY.UP_ARROW,'up');ig.input.bind(ig.KEY.DOWN_ARROW,'down');},pressedInMessageBox:function(x,y){return x>=0&&x<Constants.MSG_WINDOW_WIDTH&&y>=Constants.HEIGHT-3*Constants.TILE_DY/2&&y<Constants.HEIGHT;},onPress:function(mouseX,mouseY){if(this.pressedInMessageBox(mouseX,mouseY)){this.cancelMessage();}
else if(this.currentLevel){this.currentLevel.onPress(mouseX,mouseY);}},onRelease:function(mouseX,mouseY){if(this.currentLevel){this.currentLevel.onRelease(mouseX,mouseY);}},activateDuke:function(){if(this.currentLevel){this.currentLevel.activateDuke();}},activateAva:function(){if(this.currentLevel){this.currentLevel.activateAva();}},updateInput:function(){if(ig.input.pressed('onPress')){this.onPress(ig.input.mouse.x,ig.input.mouse.y);}
var bMouseDown=ig.input.state('onPress');if(!bMouseDown&&this.bWasMouseDown){this.onRelease(ig.input.mouse.x,ig.input.mouse.y);}
this.bWasMouseDown=bMouseDown;if(ig.input.pressed('left')){ig.Game.QueueCommand(Constants.DIRECTION.LEFT);if(this.currentLevel)this.currentLevel.updateInput();}
if(ig.input.pressed('right')){ig.Game.QueueCommand(Constants.DIRECTION.RIGHT);if(this.currentLevel)this.currentLevel.updateInput();}
if(ig.input.pressed('up')){ig.Game.QueueCommand(Constants.DIRECTION.UP);if(this.currentLevel)this.currentLevel.updateInput();}
if(ig.input.pressed('down')){ig.Game.QueueCommand(Constants.DIRECTION.DOWN);if(this.currentLevel)this.currentLevel.updateInput();}},init:function(){ig.Game._game=this;ig.Game._font=this.font;this.initSounds();ig.music.add('media/sound/gallop.mp3');this.fillLevelArray();this.curTime=(new Date).getTime()*0.001;ig.Game._animTimer=0;this.initInput();this.currentLevel=this.demoLevel;this.startLevel();this.levelIndex=-1;},startDemoLevel:function(){this.tierIndex=Constants.TIER.DEMO;this.startLevel();},startLevelInTier:function(levelIndex,tierIndex){if(tierIndex>=Constants.TIER.TUTORIAL&&tierIndex<=Constants.TIER.BOTH&&levelIndex>=0&&levelIndex<this.levels[tierIndex].length){this.tierIndex=tierIndex;this.levelIndex=levelIndex;this.startLevel();}},nextLevel:function(){if(this.tierIndex>Constants.TIER.DEMO){var oldIndex=this.levelIndex;this.levelIndex+=1;this.levelIndex=Math.min(this.levelIndex,this.levels[this.tierIndex].length-1);if(oldIndex!==this.levelIndex){this.startLevel();}
else{ig.Game.FlushMessages();this.flushMessage();ig.Game.AddMessage(Constants.TEXT_LAST_LEVEL);}}},prevLevel:function(){if(this.tierIndex>Constants.TIER.DEMO){var oldIndex=this.levelIndex;this.levelIndex-=1;this.levelIndex=Math.max(0,this.levelIndex);if(oldIndex!==this.levelIndex){this.startLevel();}
else{ig.Game.FlushMessages();this.flushMessage();ig.Game.AddMessage(Constants.TEXT_STARTING_LEVEL);}}},quitLevel:function(){ig.Game.FlushMessages();this.flushMessage();this.startDemoLevel();},startLevel:function(){if(this.tierIndex===Constants.TIER.DEMO||this.levelIndex<this.levels[this.tierIndex].length){ig.Game.FlushMessages();this.flushMessage();if(this.currentLevel){this.currentLevel.end();}
if(this.tierIndex===Constants.TIER.DEMO){this.currentLevel=this.demoLevel;ig.Game.sndTheme.play();}
else{this.currentLevel=this.levels[this.tierIndex][this.levelIndex];ig.Game.sndTheme.stop();}
this.currentLevel.stopGallopLoop();this.currentLevel.resetLevel();this.currentLevel.createField();this.currentLevel.start();}
else{ig.Game.AddMessage(Constants.TEXT_TUTORIAL_OVER,null,-1,null);}},update:function(){this.updateInput();this.parent();var newTime=(new Date).getTime()*0.001;ig.Game._dt=newTime-this.curTime
if(ig.Game._dt>ig.Game.MAX_FRAME_DT){ig.Game._dt=ig.Game.DEBUG_DT;}
this.curTime=newTime;ig.Game._animTimer+=ig.Game._dt;Sprite.computeAnimAngle();var oldDt=ig.Game._dt;this.physicsTime+=ig.Game._dt;ig.Game._dt=ig.Game.PHYSICS_DT;while(this.physicsTime>=ig.Game.PHYSICS_DT){this.currentLevel.update();this.physicsTime-=ig.Game.PHYSICS_DT;}
ig.Game._dt=oldDt;this.updateMessage();},draw:function(){if(this.background){this.background.draw(0,0);}
else{this.parent();}
this.currentLevel.draw();this.drawMessage();},drawMessage:function(){if(this.curMsg){var ctx=ig.system.context;ctx.save();var alphaParam=1;if(this.fadeDir<0){alphaParam=Math.max(0,this.msgTimer/Constants.MESSAGE_FADE_TIME);}
else if(this.fadeDir>0){alphaParam=Math.min(1-this.msgTimer/Constants.MESSAGE_FADE_TIME,1);}
ctx.globalAlpha=alphaParam;this.font.draw(this.curMsg.text,Constants.MSG_WINDOW_WIDTH/2,Constants.HEIGHT-3*Constants.TILE_DX/4-this.font.height/4,ig.Font.ALIGN.CENTER);ctx.globalAlpha=1;ctx.restore();}},cancelMessage:function(){if(this.fadeDir===0){this.fadeDir=-1;this.msgTimer=Constants.MESSAGE_FADE_TIME;}
else if(this.fadeDir>0){this.fadeDir=-1;this.msgTimer=Constants.MESSAGE_FADE_TIME-this.msgTimer;}},flushMessage:function(){this.curMsg=null;this.fadeDir=-1;this.msgTimer=0;},advanceMessage:function(){if(this.fadeDir<0&&this.msgTimer<=0&&ig.Game._curMsgIndex!==ig.Game._lastMsgIndex){ig.Game._curMsgIndex=(ig.Game._curMsgIndex+1)%ig.Game._msgQueue.length;this.fadeDir=1;this.msgTimer=Constants.MESSAGE_FADE_TIME;this.bAdvancedDuringCallback=true;this.curMsg=ig.Game._msgQueue[ig.Game._curMsgIndex];}},updateMessage:function(){if(this.msgTimer>0&&this.fadeDir===0){this.msgTimer-=ig.Game._dt;if(this.msgTimer<=0){this.msgTimer=Constants.MESSAGE_FADE_TIME;this.fadeDir=-1;}}
else if(this.fadeDir<0&&this.msgTimer>0){this.msgTimer-=ig.Game._dt;if(this.msgTimer<=0){var oldCurMsg=this.curMsg;this.bAdvancedDuringCallback=false;if(this.curMsg&&this.curMsg.callback){this.curMsg.callback();}
if(!this.bAdvancedDuringCallback){this.curMsg=null;this.advanceMessage();}}}
else if(this.fadeDir>0&&this.msgTimer>0){this.msgTimer-=ig.Game._dt;if(this.msgTimer<=0){this.fadeDir=0;this.msgTimer=ig.Game._msgQueue[ig.Game._curMsgIndex].duration;if(this.msgTimer<0){this.msgTimer=Constants.DEFAULT_MSG_TIME;}}}}});if(ig.ua.mobile){ig.Sound.enabled=false;};ig.main('#canvas',Steps,60,Constants.WIDTH,Constants.HEIGHT,1);ig.Game.resetAnimTimer=function(){ig.Game._animTimer=0;};ig.Game.ClearCommandQueue=function(){while(ig.Game._cmdQueue.length){ig.Game._cmdQueue.pop();}};ig.Game.QueueCommand=function(cmdDir){ig.Game._cmdQueue.push(cmdDir);};ig.Game.UnqueueCommand=function(){return ig.Game._cmdQueue.shift();};ig.Game.CommandReady=function(){return ig.Game._cmdQueue.length>0;};ig.Game.FlushMessages=function(){ig.Game._lastMsgIndex=-1;ig.Game._curMsgIndex=-1;ig.Game._game.flushMessage();for(var i=0;i<ig.Game._msgQueue.length;++i){var msg=ig.Game._msgQueue[i];if(msg){msg.text="";msg.speaker=null;msg.duration=-1;msg.callback=null;}}};ig.Game.ActivateDuke=function(){ig.Game._game.activateDuke();};ig.Game.ActivateAva=function(){ig.Game._game.activateAva();};ig.Game.AddMessage=function(text,speaker,duration,callback){ig.Game._lastMsgIndex=(ig.Game._lastMsgIndex+1)%ig.Game._msgQueue.length;ig.Game._msgQueue[ig.Game._lastMsgIndex].text=text;ig.Game._msgQueue[ig.Game._lastMsgIndex].speaker=speaker;ig.Game._msgQueue[ig.Game._lastMsgIndex].duration=duration;ig.Game._msgQueue[ig.Game._lastMsgIndex].callback=callback;ig.Game._game.advanceMessage();}
ig.Game.MAX_FRAME_DT=1.0;ig.Game.DEBUG_DT=1.0/30.0;ig.Game.PHYSICS_DT=1/20;ig.Game.sndButton=null;ig.Game.sndTheme=null;ig.Game.sndBlow=null;ig.Game.sndHuff=null;ig.Game.sndNeigh=null;ig.Game.sndGate=null;ig.Game._dt=0;ig.Game._animTimer=0;ig.Game._cmdQueue=[];ig.Game._font=null;ig.Game._game=null;ig.Game._lastMsgIndex=-1;ig.Game._curMsgIndex=-1;ig.Game._msgQueue=[{text:"",speaker:null,duration:-1,callback:null},{text:"",speaker:null,duration:-1,callback:null},{text:"",speaker:null,duration:-1,callback:null},{text:"",speaker:null,duration:-1,callback:null},{text:"",speaker:null,duration:-1,callback:null},{text:"",speaker:null,duration:-1,callback:null},{text:"",speaker:null,duration:-1,callback:null},{text:"",speaker:null,duration:-1,callback:null},{text:"",speaker:null,duration:-1,callback:null},{text:"",speaker:null,duration:-1,callback:null},];});